<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>jsRIA Tests</title>
<!--<script type="text/javascript" src="jsRIA/jsRIAloader.js"></script>
<script type="text/javascript">
jsRIA.setMainScriptUrl('/jsRIA/tests.js');
</script>-->
<script type="text/javascript"><!--
function ControlManager() {
	this.activeControl = null;
	this.controls = new Array();
	
	var listener = {
		controlManager : null,
		setControlManager : function(cm) {
			this.controlManager = cm;
		},
		handleEvent : function(e) {
			e = e ? e : window.event;
			e.source = e.target ? e.target : e.srcElement;
			e.x = e.pageX ? e.pageX : e.clientX;
			e.y = e.pageY ? e.pageY : e.clientY;
			this.event = e;
			var cm = this.controlManager;
			eval("cm.handleEvent(this)");
		}
	};
	listener.setControlManager(this);

	/*var em = gaia.getEventManager();
	em.addEventListener(window, "keydown", listener);
	em.addEventListener(window, "mousedown", listener);*/
}

ControlManager.prototype.addControl = function(control) {
	if (!this.controls.contains(control)) {
		this.controls.push(control);
	}
}

ControlManager.prototype.focusGained = function(control) {
	if (!control instanceof Control) {
		throw new WrongObjectException("control is not instance of Control", "ControlManager", "focusGained");
	}

	this.activeControl = control;
}

ControlManager.prototype.focusLost = function(control) {
	// dummy method
}

ControlManager.prototype.handleEvent = function(e) {
	if (e.event.type == "keydown") {
		if (this.activeControl != null && this.activeControl.keyHandler) {
			this.activeControl.keyHandler(e);
		}
	}

	if (e.event.type == "mousedown") {
		if (this.activeControl != null) {
			this.activeControl.looseFocus();
			this.activeControl = null;
		}
	}
}

ControlManager.prototype.removeControl = function(control) {
	if (this.controls.contains(control)) {
		if (this.activeControl == control) {
			this.activeControl = null;
		}
		var iIndex = this.controls.indexOf(control);
		this.controls.remove(iIndex);
	}
}

ControlManager.prototype.toString = function() {
	return "[object ControlManager]";
}
jsWT = {
	controlManager : new ControlManager(),
	toString : function() {
		return "[object jsWT]";
	},
	
	getControlManager : function() {
		return this.controlManager;
	}
}
alert(jsWT);
--></script>
</head>
<body>

<div id="box" style="width: 300px; height: 150px; border: 1px solid #555; background-color: #CCC;">
Klick mich
</div>

</body>
</html>