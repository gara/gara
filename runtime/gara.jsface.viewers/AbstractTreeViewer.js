gara.provide("gara.jsface.viewers.AbstractTreeViewer");gara.require("gara.jsface.viewers.ColumnViewer");gara.require("gara.jsface.viewers.ITreeContentProvider");gara.require("gara.jswt.JSWT");$package("gara.jsface.viewers");$class("AbstractTreeViewer",{$extends:gara.jsface.viewers.ColumnViewer,$constructor:function(){},_createTreeItem:function(b,c,d){var e=this._newItem(b,gara.jswt.JSWT.NULL,d);this._updateItem(e,c)},_disassociate:function(b){this.$base(b);this._disassociateChildren(b)},_disassociateChildren:function(b){var c=this._getChildren(b);for(var d=0;d<c.length;d++){if(c[d].getData()!=null){this._disassociate(c[d])}}},_doGetColumnCount:function(){return 0},_doGetSelection:$abstract(function(){}),_doFindInputItem:function(b){var c=this._getRoot();if(c==null){return null}if(c==b){return this.getControl()}return null},_doFindItem:function(b){var c=getRoot();if(c==null){return null}var d=this._getChildren(this.getControl());if(d!=null){for(var e=0;e<d.length;e++){var g=this._internalFindItem(d[e],b);if(g!=null){return g}}}return null},_doUpdateItem:function(b,c){if(b.isDisposed()){this._unmapElement(c,b);return}var d=this._getViewerRowFromItem(b);var e=this._doGetColumnCount();if(e==0){e=1}for(var g=0;g<e;g++){var f=this._getViewerColumn(g);var h=this._updateCell(d,g,c);f.refresh(h);if(b.isDisposed()){this._unmapElement(c,b);return}}this._associate(c,b)},_getChildren:$abstract(function(){}),getControl:$abstract(function(){}),_getExpanded:$abstract(function(b){}),_getLabelProviderText:function(b,c){var d=b.getText(c);if(d==null){d=""}return d},_getRawChildren:function(b){var c=this.getContentProvider();if(b==this._getRoot()){return this.$base(b)}else if($class.instanceOf(c,gara.jsface.viewers.ITreeContentProvider)){var d=c.getChildren(b);if(d!=null){return d}}return[]},_getSelectionFromWidget:function(){var b=this._doGetSelection();var c=[];for(var d=0;d<b.length;d++){var e=b[d];var g=e.getData();if(g!=null){c.push(g)}}return c},inputChanged:function(b,c){this._treeRemoveAll();this._internalRefresh()},_internalFindItem:function(b,c){var d=b.getData();if(d!=null){if(d==c){return b}}var e=this._getChildren(b);for(var g=0;g<e.length;g++){var f=e[g];var h=this._internalFindItem(f,c);if(h!=null){return h}}return null},_internalRefresh:function(g,f){var h=[];var a=this.getControl().getSelection();for(var k=0;k<a.length;++k){h.push(a[k].getData())}if(g==null||g==this._getRoot()){this._internalRefreshItems(this.getControl(),this._getRoot(),f)}else{var j=this._findItems(g);if(j.length!=0){for(var k=0;k<j.length;k++){this._internalRefreshItems(j[k],g,f)}}}var a=[];h.forEach(function(b,c,d){var e=this._getItemFromElementMap(b);if(e!=null){a.push(e)}},this);this.getControl().update();this.getControl().setSelection(a)},_internalRefreshItems:function(b,c,d){this._updateChildren(b,c,d);var e=this._getChildren(b);if(e!=null){for(var g=0;g<e.length;g++){var f=e[g];var h=f.getData();if(h!=null){this._internalRefreshItems(f,h,d)}}}},_newItem:$abstract(function(b,c,d){}),_setExpanded:$abstract(function(b,c){}),_treeRemoveAll:$abstract(function(){}),_updateChildren:function(b,c,d){var e=this._getSortedChildren(c);var g=this.getControl();var f=this._getChildren(b);var h=[];for(var a=0;a<f.length;++a){if(this._getExpanded(f[a])){var k=f[a].getData();if(k!=null){h.push(k)}}}var j=Math.min(e.length,f.length);var n=f.length-j;if(n>0){var o=[];for(var a=0;a<e.length;a++){o.push(e[a])}var a=0;while(n>0&&a<f.length){var m=f[a].getData();if(m==null||f.length-a<=n||!o.contains(m)){if(m!=null){this._disassociate(f[a])}f[a].dispose();f.removeAt(a);n--}else{a++}}}for(var a=0;a<j;++a){var i=f[a];var p=i.getData();if(p!=null){var l=e[a];if(l==p){var m=i.getData();if(m!=null){this._unmapElement(m,i)}i.setData(l);this._mapElement(l,i)}else{this._disassociate(i);i.setImage(null);i.setText("")}}}for(var a=0;a<j;++a){var i=f[a];var l=e[a];if(i.getData()==null){this._associate(l,i);this._updateItem(i,l)}else{if(d){this._updateItem(i,l)}}}for(var a=0;a<j;++a){var i=f[a];var l=e[a];if(h.contains(l)){this._setExpanded(i,true)}}if(j<e.length){for(var a=j;a<e.length;++a){this._createTreeItem(b,e[a],a)}if(h.length>0){f=this._getChildren(b);for(var a=j;a<e.length;++a){if(h.contains(e[a])){this._setExpanded(f[a],true)}}}}},setContentProvider:function(b){if(!$class.instanceOf(b,gara.jsface.viewers.ITreeContentProvider)){throw new TypeError("contentProvider is not type of gara.jsface.viewers.ITreeContentProvider");}this._contentProvider=b}});