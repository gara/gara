gara.provide("gara.jsface.viewers.StructuredViewer");gara.require("gara.jsface.viewers.ContentViewer");gara.require("gara.jsface.viewers.ViewerFilter");gara.require("gara.jsface.viewers.ViewerSorter");gara.require("gara.jsface.viewers.SelectionChangedEvent");gara.require("gara.jswt.events.SelectionListener");gara.require("gara.jswt.widgets.Widget");$package("gara.jsface.viewers");$class("StructuredViewer",{$implements:[gara.jswt.events.SelectionListener],$extends:gara.jsface.viewers.ContentViewer,$constructor:function(){this._map=[];this._items=[];this._sorter=null;this._filters=[];this._elementMap=null},addFilter:function(a){if(!$class.instanceOf(a,gara.jsface.viewers.ViewerFilter)){throw new TypeError("filter not instance of gara.jsface.viewers.ViewerFilter");}if(!this._filters.contains(a)){this._filters.push(a)}this.refresh()},_associate:function(a,b){var c=b.getData();if(c!=a){if(c!=null){this._disassociate(b)}b.setData(a)}this._mapElement(a,b)},_disassociate:function(a){var b=a.getData();this._unmapElement(b,a);a.setData(null)},_doUpdateItem:$abstract(function(a,b){}),_doFindInputItem:$abstract(function(a){}),_findItem:$final(function(a){var b=this._findItems(a);return b.length==0?null:b[0]}),_findItems:$final(function(a){if(!a.hasOwnProperty("__garaUID")){return[]}var b=this._doFindInputItem(a);if(b!=null){return[b]}if(this._usingElementMap()){var c=null;if(a.hasOwnProperty("__garaUID")&&this._elementMap.hasOwnProperty(a.__garaUID)){c=this._elementMap[a.__garaUID]}if(c==null){return[]}else if($class.instanceOf(c,gara.jswt.widgets.Widget)){return[c]}else{return c}}return[]}),_getRawChildren:function(a){var b=null;if(a!=null){var c=this.getContentProvider();if(c!=null){b=c.getElements(a)}}return(b!=null&&$class.instanceOf(b,Array))?b:[]},_getItemFromElementMap:function(a){if(a==null){return null}var b;if(typeof(a)=="object"&&a.hasOwnProperty("__garaUID")){b=a.__garaUID}else{b=a}if(this._elementMap.hasOwnProperty(b)){return this._elementMap[b]}return null},_getFilteredChildren:function(d){var e=this._getRawChildren(d);this._filters.forEach(function(a,b,c){e=a.filter(this,d,e)},this);return e},_getSelection:function(){var a=this.getControl();if(a==null||a.isDisposed()){return[]}return this._getSelectionFromWidget()},_getSelectionFromWidget:$abstract(function(){}),_getSortedChildren:function(a){var b=this._getFilteredChildren(a);if(this._sorter!=null){b=this._sorter.sort(this,b)}return b},getSorter:function(){if($class.instanceOf(this._sorter,gara.jsface.viewers.ViewerSorter)){return this._sorter}return null},_getRoot:function(){return this._input},_hookControl:function(a){a.addSelectionListener(this)},_handleSelect:function(a){control=this.getControl();if(control!=null&&!control.isDisposed()){this._updateSelection(this._getSelection())}},_internalRefresh:$abstract(function(a,b){}),_mapElement:function(a,b){if(this._elementMap==null){this._elementMap={}}var c=new Date();var d=c.valueOf();if(typeof(a)=="object"){if(!a.hasOwnProperty("__garaUID")){a.__garaUID=d}else{d=a.__garaUID}}else{d=a}this._elementMap[d]=b},refresh:function(a,b){var c,d;if(typeof(a)=="boolean"){d=a}else if(typeof(a)=="object"){c=a}if(typeof(b)=="boolean"){d=b}this._internalRefresh(c,d)},setFilters:function(d){if(d.length==0){this._filters=[]}else{d.forEach(function(a,b,c){this.addFilter(a)},this)}},setInput:function(a){this._unmapAllElements();this.$base(a)},setSorter:function(a){if(!$class.instanceOf(a,gara.jsface.viewers.ViewerSorter)){throw new TypeError("sorter not instance of gara.jsface.viewers.ViewerSorter");}this._sorter=a;this.refresh()},_unmapAllElements:function(){this._elementMap={}},_unmapElement:function(a,b){if(this._elementMap==null||a==null||!(typeof(a)=="object"&&a.hasOwnProperty("__garaUID"))){return}var c;if(typeof(a)=="object"&&a.hasOwnProperty("__garaUID")){c=a.__garaUID}else{c=a}if($class.instanceOf(b,Array)){this._elementMap[c]=b}else{delete this._elementMap[c]}},_updateItem:function(a,b){this._doUpdateItem(a,b)},_usingElementMap:function(){return this._elementMap!=null},_updateSelection:function(a){var b=new gara.jsface.viewers.SelectionChangedEvent(this,a);this._fireSelectionChanged(b)},widgetSelected:function(a){this._handleSelect(a)}});$package("");