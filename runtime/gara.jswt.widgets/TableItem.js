gara.provide("gara.jswt.widgets.TableItem");gara.use("gara.EventManager");gara.use("gara.jswt.JSWT");gara.parent("gara.jswt.widgets.Item",function(){gara.Class("gara.jswt.widgets.TableItem",{$extends:gara.jswt.widgets.Item,cells:[],checkboxTd:null,checkbox:null,active:false,checked:false,grayed:false,selected:false,$constructor:function(a,b,c){if(!(a instanceof gara.jswt.widgets.Table)){throw new TypeError("parent is not a gara.jswt.widgets.Table");}this.$super(a,b);this.parentNode=this.parent.addItem(this,c);this.cells=[];this.checkboxTd=null;this.checkbox=null;this.active=false;this.checked=false;this.grayed=false;this.selected=false;this.createWidget()},adjustWidth:function(){var a=this.parent.getColumnOrder(),b,c;for(b=0,len=a.length;b<len;++b){c=this.cells[a[b]];if(c&&c.td){c.td.style.width=this.parent.getColumn(a[b]).getWidth()+"px"}}},bindListener:function(a,b){gara.EventManager.addListener(this.handle,a,b)},clear:function(){this.checkWidget();this.text="";this.image=null;this.cells=[];this.active=this.checked=this.selected=this.grayed=false},createWidget:function(){var a,b,c;this.handle=document.createElement("tr");this.handle.id=this.getId();this.handle.widget=this;this.handle.control=this.parent;this.handle.setAttribute("role","row");if((this.parent.getStyle()&gara.jswt.JSWT.CHECK)===gara.jswt.JSWT.CHECK){this.checkbox=document.createElement("span");this.checkbox.widget=this;this.checkbox.control=this.tree;this.setCheckboxClass();this.checkbox.setAttribute("role","presentation");this.checkboxTd=document.createElement("td");this.checkboxTd.className="jsWTTableCheckboxCol";this.checkboxTd.appendChild(this.checkbox);this.checkboxTd.setAttribute("role","presentation");this.handle.appendChild(this.checkboxTd);this.handle.setAttribute("aria-checked",this.checked)}a=this.parent.getColumnOrder();for(var b=0,d=a.length,e=this.cells.length;b<d&&b<e;++b){c=this.cells[a[b]];this.createCell(c);this.handle.appendChild(c.td);c.td.className=b===0?"first":""}this.parentNode.appendChild(this.handle);this.parent.updateMeasurements()},createCell:function(a){var b=this.cells.indexOf(a),c,d,e=this.parent.getColumnOrder(),f=e.indexOf(b);a.td=document.createElement("td");a.td.role="gridcell";a.td.widget=this;a.td.control=this.parent;a.index=b;a.td.setAttribute("aria-labelledby",this.getId()+"-label-"+b);a.img=document.createElement("img");a.img.id=this.getId()+"-image-"+b;a.img.widget=this;a.img.control=this.parent;a.td.appendChild(a.img);a.img.setAttribute("role","presentation");if(a.image){a.img.src=a.image.src}else{a.img.style.display="none"}a.textNode=document.createTextNode(a.text);a.span=document.createElement("span");a.span.id=this.getId()+"-label-"+b;a.span.className="text";a.span.widget=this;a.span.control=this.parent;a.span.appendChild(a.textNode);a.span.setAttribute("role","presentation");a.td.appendChild(a.span);for(c=0;c<f;++c){d=this.cells[e[c]];if(!d.td){this.createCell(d)}d.td.className=c===0?"first":""}this.handle.appendChild(a.td);a.td.className=c===0?"first":""},dispose:function(){var a,b;this.$super();for(b=0,len=this.cells.length;b<len;b++){a=this.cells[b];if(a.img){a.td.removeChild(a.img);delete a.img;a.image=null}this.handle.removeChild(a.td);delete a.td}this.cells=null;delete this.cells;this.parentNode.removeChild(this.handle);delete this.handle},getChecked:function(){this.checkWidget();return this.checked},getGrayed:function(){this.checkWidget();return this.grayed},getText:function(a){this.checkWidget();if(this.cells[a]){return this.cells[a].text}return null},getImage:function(a){this.checkWidget();if(this.cells[a]){return this.cells[a].image}return null},handleEvent:function(a){this.checkWidget();if((a.target===this.checkbox&&a.type==="mousedown")||(a.target===this.checkbox&&a.type==="mouseup")||(a.type==="keydown"&&a.keyCode===gara.jswt.JSWT.SPACE)){a.info=gara.jswt.JSWT.CHECK;if(a.type==="mouseup"){this.setChecked(!this.checked)}}},setCheckboxClass:function(){this.checkbox.className="jsWTCheckbox";if(this.checked&&this.grayed){this.checkbox.className+=" jsWTCheckboxGrayedChecked"}else if(this.grayed){this.checkbox.className+=" jsWTCheckboxGrayed"}else if(this.checked){this.checkbox.className+=" jsWTCheckboxChecked"}},setChecked:function(a){if(!this.grayed){this.checked=a;this.handle.setAttribute("aria-checked",this.checked);this.setCheckboxClass()}return this},setGrayed:function(a){this.grayed=a;this.checkbox.setAttribute("aria-disabled",this.grayed);this.setCheckboxClass();return this},setImage:function(d,e){var f=this,g=function(a,b){a.image=b;if(!a.td){f.createCell(a)}else{a.img.src=b.src;a.img.style.display=""}};if(!e){e=d;d=0}if(typeof(e)==="undefined"||e===null){return}if(e instanceof Array){e.forEach(function(a,b,c){if(!this.cells[b]){this.cells[b]={}}g(this.cells[b],a)},this)}else{if(!this.cells[d]){this.cells[d]={}}g(this.cells[d],e)}return this},setSelected:function(a){this.checkWidget();this.selected=a;this.handle.setAttribute('aria-selected',this.selected)},setText:function(d,e){var f=this,g=function(a,b){a.text=b;if(!a.td){f.createCell(a)}else{a.textNode.value=b}};this.checkWidget();if(typeof(e)==="undefined"){e=d;d=0}if(e instanceof Array){e.forEach(function(a,b,c){if(!this.cells[b]){this.cells[b]={}}g(this.cells[b],a)},this)}else{if(!this.cells[d]){this.cells[d]={}}g(this.cells[d],e)}return this},unbindListener:function(a,b){gara.EventManager.removeListener(this.handle,a,b)},update:function(){var a,b,c;this.checkWidget();if(this.handle===null){this.create()}else{while(this.handle.childNodes.length){this.handle.removeChild(this.handle.childNodes[0])}if((this.parent.getStyle()&gara.jswt.JSWT.CHECK)===gara.jswt.JSWT.CHECK){this.handle.appendChild(this.checkboxTd)}a=this.parent.getColumnOrder();for(b=0,len=a.length;b<len;b++){c=this.cells[a[b]];if(!c.td){this.createCell(c)}c.td.className=b===0?"first":"";this.handle.appendChild(c.td)}}}})});