gara.provide("gara.jswt.widgets.TableColumn");gara.use("gara.EventManager");gara.use("gara.jswt.JSWT");gara.use("gara.jswt.widgets.TableItem");gara.require("gara.jswt.widgets.Item");gara.ready(function(){gara.Class("gara.jswt.widgets.TableColumn",{$extends:gara.jswt.widgets.Item,shadow:null,width:0,img:null,span:null,spanText:null,operator:null,moveable:true,resizable:true,isMoving:false,isResizing:false,$constructor:function(b,c,f){if(!(b instanceof gara.jswt.widgets.Table)){throw new TypeError("parent is not a gara.jswt.widgets.Table");}this.$super(b,c);this.parentNode=this.parent.addColumn(this,f);this.shadow=null;this.width=null;this.img=null;this.span=null;this.spanText=null;this.operator=null;this.moveable=true;this.resizable=true;this.isMoving=false;this.isResizing=false;this.createWidget()},bindListener:function(){},createWidget:function(){var b,c,f,e,a,d;this.handle=document.createElement("th");this.handle.id=this.getId();this.handle.widget=this;this.handle.control=this.parent;this.handle.setAttribute("role","columnheader");this.handle.setAttribute("aria-labelledby",this.getId()+"-label");this.handle.setAttribute("unselectable","on");this.img=document.createElement("img");this.img.id=this.getId()+"-image";this.img.widget=this;this.img.control=this.tree;this.img.setAttribute("role","presentation");this.img.setAttribute("unselectable","on");if(this.image!==null){this.img.src=this.image.src}else{this.img.style.display="none"}this.operator=document.createElement("span");this.operator.className="mover";this.operator.id=this.getId()+"-operator";this.operator.widget=this;this.operator.control=this.parent;this.operator.setAttribute("role","presentation");this.operator.setAttribute("unselectable","on");this.span=document.createElement("span");this.span.id=this.getId()+"-label";this.span.widget=this;this.span.control=this.parent;this.span.className="text";this.spanText=document.createTextNode(this.text);this.span.appendChild(this.spanText);this.span.setAttribute("role","presentation");this.span.setAttribute("unselectable","on");this.handle.appendChild(this.img);this.handle.appendChild(this.operator);this.handle.appendChild(this.span);if(this.parentNode!==null){b=this.parentNode.parentNode;b.style.position="relative";this.parentNode.appendChild(this.handle);c=this.parent.getColumns();f=0;d=this.parentNode.clientWidth;for(e=0,len=c.length;e<len-1;++e){a=Math.floor(d/len);f+=a;c[e].setWidth(a);c[e].setClass("operator",true)}this.setWidth(d-f);b.style.position="absolute"}this.parent.updateMeasurements()},computeWidth:function(){this.checkWidget();if(this.handle!==null&&this.handle.style.display!=="none"){this.width=this.handle.offsetWidth;this.width=this.width===0?null:this.width}},dispose:function(){this.$super();if(this.img!==null){this.handle.removeChild(this.img);delete this.img;delete this.image}this.handle.removeChild(this.operator);this.handle.removeChild(this.span);if(this.parentNode!==null){this.parentNode.removeChild(this.handle)}delete this.operator;delete this.span;delete this.handle},getWidth:function(){var b,c;this.checkWidget();if(this.width===null||this.width==="auto"){this.computeWidth()}b=this.parent.getColumns();c=this.parent.getColumnOrder();if(b[c[c.length-1]]===this&&this.parent.getVerticalScrollbar()){return this.width-gara.jswt.JSWT.SCROLLBAR_WIDTH}return this.width},handleEvent:function(a){var d,o,p,g,h,k,l,i,m,q,j,r,s,n;this.checkWidget();switch(a.type){case"mousedown":if(a.target===this.operator&&this.resizable){this.isResizing=true;this.allColsWidth=0;g=this.parent.getColumns();g.forEach(function(b,c,f){this.allColsWidth+=b.getWidth()},this);d=this.parent.getColumnOrder();o=g.indexOf(this);p=d.indexOf(o);this.nextColumn=g[d[p+1]];this.lessColsWidth=this.allColsWidth-this.getWidth()-this.nextColumn.getWidth();this.resizeStart=a.clientX;this.startWidth=this.width;this.nextStartWidth=this.nextColumn.getWidth();if(this.parent.getVerticalScrollbar()){if(this.nextColumn===g[d[d.length-1]]){this.nextStartWidth+=gara.jswt.JSWT.SCROLLBAR_WIDTH}this.allColsWidth+=gara.jswt.JSWT.SCROLLBAR_WIDTH}gara.EventManager.addListener(document,"mousemove",this);gara.EventManager.addListener(document,"mouseup",this)}if(a.target===this.handle&&this.moveable){this.isMoving=true;d=this.parent.getColumns();h=d.indexOf(this);this.shadow=new gara.jswt.widgets.Table(document.getElementsByTagName("body")[0],this.parent.getStyle()&~gara.jswt.JSWT.CHECK);this.shadow.setHeaderVisible(this.parent.getHeaderVisible());this.shadow.setLinesVisible(this.parent.getLinesVisible());this.shadow.setHeight(this.parent.getHeight());this.shadow.addClass("jsWTTableShadow");this.parent.getColumns().forEach(function(b,c,f){var e;if(c===h){e=new gara.jswt.widgets.TableColumn(this.shadow);e.setText(b.getText());e.setWidth(b.getWidth()+(h===d.length-1?gara.jswt.JSWT.SCROLLBAR_WIDTH*2:gara.jswt.JSWT.SCROLLBAR_WIDTH))}},this);this.parent.getItems().forEach(function(b){var c=new gara.jswt.widgets.TableItem(this.shadow);c.setText(b.getText(h));c.setImage(b.getImage(h))},this);if(!a.pageX){a.pageX=a.clientX+document.documentElement.scrollLeft}if(!a.pageY){a.pageY=a.clientY+document.documentElement.scrollTop}this.shadow.handle.style.left=a.pageX+16+"px";this.shadow.handle.style.top=a.pageY+16+"px";gara.EventManager.addListener(document,"mousemove",this);gara.EventManager.addListener(document,"mouseup",this)}break;case"mousemove":if(this.isResizing){k=20;l=a.clientX-this.resizeStart;m=this.startWidth+l;i=this.nextStartWidth-l;if(m>k&&i>k){this.width=m;this.handle.style.width=this.width+"px";this.nextColumn.handle.style.width=i+"px";this.nextColumn.setWidth(i);this.parent.getItems()[0].adjustWidth()}}if(this.isMoving){if(!a.pageX){a.pageX=a.clientX+document.documentElement.scrollLeft}if(!a.pageY){a.pageY=a.clientY+document.documentElement.scrollTop}this.shadow.handle.style.left=a.pageX+16+"px";this.shadow.handle.style.top=a.pageY+16+"px"}break;case"mouseup":if(this.isResizing){gara.EventManager.removeListener(document,"mousemove",this);gara.EventManager.removeListener(document,"mouseup",this);this.isResizing=false}if(this.isMoving){gara.EventManager.removeListener(document,"mousemove",this);gara.EventManager.removeListener(document,"mouseup",this);this.isMoving=false;this.shadow.dispose();delete this.shadow;this.shadow=null;if(a.target.widget&&a.target.widget instanceof gara.jswt.widgets.TableColumn&&a.target.widget.getParent()===this.parent){q=a.target.widget;j=this.parent.getColumnOrder();r=this.parent.getColumns().indexOf(q);s=j.indexOf(r);n=this.parent.getColumns().indexOf(this);j.remove(n);j.insertAt(s,n);this.parent.update()}}break}},setImage:function(b){this.$super(b);if(this.image!==null){this.img.src=this.image.src;this.img.style.display=""}else{this.img.src="";this.img.style.display="none"}return this},setText:function(b){this.$super(b);this.spanText.nodeValue=this.text;return this},setWidth:function(b){this.checkWidget();this.width=b;this.handle.style.width=this.width+"px";return this},unbindListener:function(b,c){},update:function(){var b;this.checkWidget();if(this.handle===null){this.create()}b=this.parent.getColumnOrder();this.setClass("operator",this.parent.getColumns()[b[b.length-1]]!==this)}})});