gara.provide("gara.jswt.widgets.Button");gara.use("gara.jswt.JSWT");gara.use("gara.jswt.widgets.Composite");gara.parent("gara.jswt.widgets.Control",function(){gara.Class("gara.jswt.widgets.Button",{$extends:gara.jswt.widgets.Control,text:"",image:null,img:null,span:null,spanText:null,pressEvent:null,selected:false,selectionListeners:[],$constructor:function(a,b){this.text="";this.image=null;this.img=null;this.span=null;this.spanText=null;this.pressEvent=null;this.selected=false;this.selectionListeners=[];if(!((b&gara.jswt.JSWT.PUSH)===gara.jswt.JSWT.PUSH||(b&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO||(b&gara.jswt.JSWT.CHECK)===gara.jswt.JSWT.CHECK)){b|=gara.jswt.JSWT.PUSH}if(!((b&gara.jswt.JSWT.VERTICAL)===gara.jswt.JSWT.VERTICAL||(b&gara.jswt.JSWT.HORIZONTAL)===gara.jswt.JSWT.HORIZONTAL)){b|=gara.jswt.JSWT.HORIZONTAL}this.$super(a,b)},addSelectionListener:function(a){this.checkWidget();if(!this.selectionListeners.contains(a)){this.selectionListeners.push(a)}return this},bindListener:function(a,b){gara.EventManager.addListener(this.handle,a,b)},createWidget:function(){var a,b;this.createHandle("span");this.handle.setAttribute("role","button");this.handle.setAttribute("aria-disabled",!this.enabled);this.handle.setAttribute("aria-labelledby",this.getId()+"-label");this.addClass("jsWTButton");this.setClass("jsWTButtonPush",(this.style&gara.jswt.JSWT.PUSH)===gara.jswt.JSWT.PUSH);this.setClass("jsWTButtonHorizontal",(this.style&gara.jswt.JSWT.HORIZONTAL)===gara.jswt.JSWT.HORIZONTAL);this.setClass("jsWTButtonVertical",(this.style&gara.jswt.JSWT.VERTICAL)===gara.jswt.JSWT.VERTICAL);if((this.style&gara.jswt.JSWT.CHECK)===gara.jswt.JSWT.CHECK){this.addClass("jsWTButtonCheckbox");this.handle.setAttribute("role","checkbox");this.handle.setAttribute("aria-checked",this.selected)}if((this.style&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO){this.addClass("jsWTButtonRadio");this.handle.setAttribute("role","radio");this.handle.setAttribute("aria-checked",this.selected)}this.addListener("mousedown",this);this.addListener("mouseup",this);a=document.createElement("span");a.widget=this;a.className="focus";a.setAttribute("role","presentation");b=document.createElement("span");b.widget=this;b.className="door";b.setAttribute("role","presentation");this.img=document.createElement("img");this.img.id=this.getId()+"-image";this.img.widget=this;this.img.control=this.list;this.img.setAttribute("role","presentation");if(this.image!==null){this.img.src=this.image.src}else{this.img.style.display="none"}this.spanText=document.createTextNode(this.text);this.span=document.createElement("span");this.span.id=this.getId()+"-label";this.span.widget=this;this.span.control=this.list;this.span.className="text";this.span.appendChild(this.spanText);this.span.setAttribute("role","presentation");this.handle.appendChild(a);this.handle.appendChild(b);b.appendChild(this.img);b.appendChild(this.span)},dispose:function(){},getImage:function(){return this.image},getSelection:function(){return this.selected},getSiblingRadioButtons:function(){var a,b,c,d,e,f;if(this.parent instanceof gara.jswt.widgets.Composite){a=this.parent.getChildren()}else{a=[];b=this.parent.childNodes;for(c=0,len=b.length;c<len;c++){d=b[c];if(d.widget&&d.widget instanceof gara.jswt.widgets.Control){a.push(d.widget)}}}e=[this];f=a.indexOf(this);for(c=f-1;c>=0&&a[c]instanceof gara.jswt.widgets.Button&&(a[c].getStyle()&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO;--c){e.unshift(a[c])}for(c=f+1;c<a.length&&a[c]instanceof gara.jswt.widgets.Button&&(a[c].getStyle()&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO;++c){e.push(a[c])}return e},getText:function(){return this.text},focusGained:function(a){var b,c,d,e;if((this.style&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO){b=this.getSiblingRadioButtons();c=b.indexOf(this);d=c-1;e=c+1;while(b[d]){b[d].handle.tabIndex=-1;d--}while(b[e]){b[e].handle.tabIndex=-1;e++}this.handle.tabIndex=0}this.$super(a)},handleEvent:function(a){this.checkWidget();if(!this.enabled){return}a.widget=this;this.event=a;this.handleMouseEvents(a);if(this.menu!==null&&this.menu.isVisible()){this.menu.handleEvent(a)}else{this.handleKeyEvents(a);this.handleMenu(a)}this.$super(a);a.stopPropagation();return false},handleMouseEvents:function(a){switch(a.type){case"mousedown":this.handle.setAttribute("aria-pressed",true);this.pressEvent=gara.EventManager.addListener(document,"mouseup",this);break;case"mouseup":this.handle.setAttribute("aria-pressed",false);if(this.pressEvent!==null){gara.EventManager.removeListener(document,"mouseup",this);this.pressEvent=null}if(a.target.widget&&a.target.widget===this){this.setSelection((this.style&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO?true:!this.getSelection())}break}},handleKeyEvents:function(a){var b,c,d,e;switch(a.type){case"keyup":this.handle.setAttribute("aria-pressed",false);this.preventScrolling(a);break;case"keydown":switch(a.keyCode){case gara.jswt.JSWT.SPACE:this.handle.setAttribute("aria-pressed",true);this.setSelection((this.style&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO?true:!this.getSelection());break;case gara.jswt.JSWT.ARROW_DOWN:case gara.jswt.JSWT.ARROW_RIGHT:b=this.getSiblingRadioButtons();c=b.indexOf(this);d=c+1;if(d>=b.length){d=0}while(d<=b.length){if(b[d].getEnabled()){break}d=d<b.length-1?d+1:b.length-1;if(d<=b.length&&!b[d].getEnabled()){d=0}}if(!a.ctrlKey){b[d].setSelection(true)}b[d].forceFocus();break;case gara.jswt.JSWT.ARROW_UP:case gara.jswt.JSWT.ARROW_LEFT:b=this.getSiblingRadioButtons();c=b.indexOf(this);e=c-1;if(e<0){e=b.length-1}while(e>=0){if(b[e].getEnabled()){break}e=e>0?e-1:0;if(e>=0&&!b[e].getEnabled()){e=b.length-1}}if(!a.ctrlKey){b[e].setSelection(true)}b[e].forceFocus();break;case gara.jswt.JSWT.ENTER:this.notifySelectionListener();break}this.preventScrolling(a);break}},notifySelectionListener:function(){this.selectionListeners.forEach(function(a){if(a.widgetSelected){a.widgetSelected(this.event)}},this)},removeSelectionListener:function(a){this.checkWidget();this.selectionListeners.remove(a)},setImage:function(a){this.image=a;if(this.handle){if(this.image!==null){this.img.src=this.image.src;this.img.style.display=""}else{this.img.src="";this.img.style.display="none"}}return this},setSelection:function(a){var b,c,d,e;this.checkWidget();if(((this.style&gara.jswt.JSWT.CHECK)===gara.jswt.JSWT.CHECK||(this.style&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO)&&this.enabled){this.selected=a;if(this.handle){this.handle.setAttribute("aria-checked",this.selected)}if((this.style&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO&&a){b=this.getSiblingRadioButtons();c=b.indexOf(this);d=c-1;e=c+1;while(b[d]){b[d].setSelection(false);d--}while(b[e]){b[e].setSelection(false);e++}}}this.notifySelectionListener();return this},setText:function(a){this.text=a;this.spanText.nodeValue=this.text;return this},unbindListener:function(a,b){gara.EventManager.removeListener(this.handle,a,b)},update:function(){this.checkWidget()}})});