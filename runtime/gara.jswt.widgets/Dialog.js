gara.provide("gara.jswt.widgets.Dialog");gara.use("gara.jswt.JSWT");gara.use("gara.jswt.widgets.Composite");gara.require("gara.jswt.widgets.Widget");gara.require("gara.jswt.widgets.DialogManager");gara.Class("gara.jswt.widgets.Dialog",{$extends:gara.jswt.widgets.Widget,$constructor:function(a){this._parentWindow=window;this.$base(this._parentWindow.document.getElementsByTagName("body")[0],a);this._disposed=false;this._text=" ";this.handle=null;this._modalLayer=null;this._dialogBar;this._dialogBarLeft;this._dialogBarText;this._dialogBarButtons;this._dialogContent;this._barCancelButton;this._dX;this._dY;this._tabIndexes=[];this._tabIndexElements=[];this._tabbableTags=["A","BUTTON","TEXTAREA","INPUT","IFRAME","DIV","UL","SPAN"];this._parentWindow.gara.jswt.widgets.DialogManager.getInstance().addDialog(this);this.addClass("jsWTDialog")},_create:function(){if((this._style&gara.jswt.JSWT.APPLICATION_MODAL)==gara.jswt.JSWT.APPLICATION_MODAL){this._disableTabIndexes();var b;if(b=this._parentWindow.document.getElementById("jsWTModalLayer")){b.style.display="block"}else{b=this._parentWindow.document.createElement("div");b.id="jsWTModalLayer";this._parent.appendChild(b)}b.style.position="absolute";b.style.top="0";b.style.bottom="0";b.style.left="0";b.style.right="0";this.addClass("jsWTDialogModal")}this.handle=document.createElement("div");this.handle.className=this._classes.join(" ");this.handle.widget=this;this.handle.id=this.getId();this.handle.role="dialog";base2.DOM.Event(this.handle);this.handle.setAttribute("aria-labelledby",this.getId()+"-label");this._dialogBar=document.createElement("div");this._dialogBar.className="jsWTDialogBar";this._dialogBarLeft=document.createElement("div");this._dialogBarLeft.className="jsWTDialogBarLeft";this._dialogBarTitle=document.createElement("div");this._dialogBarTitle.className="jsWTDialogBarText";this._dialogBarTitle.id=this.getId()+"-label";this._dialogBarText=document.createTextNode(this._text);this._dialogBarButtons=document.createElement("div");this._dialogBarButtons.className="jsWTDialogBarButtons";var d=document.createElement("div");d.className="jsWTDialogBarClearer";this._barCancelButton=document.createElement("span");this._barCancelButton.className="jsWTDialogCancelButton";this.handle.appendChild(this._dialogBar);this._dialogBar.appendChild(this._dialogBarLeft);this._dialogBar.appendChild(this._dialogBarTitle);this._dialogBar.appendChild(this._dialogBarButtons);this._dialogBarTitle.appendChild(this._dialogBarText);this._dialogBarButtons.appendChild(this._barCancelButton);this._dialogBar.appendChild(d);this._dialogContent=new gara.jswt.widgets.Composite(this.handle).addClass("jsWTDialogContent");this._parentWindow.gara.EventManager.addListener(this.handle,"mousedown",this);this._parentWindow.gara.EventManager.addListener(this.handle,"keydown",this);this._parentWindow.gara.EventManager.addListener(this._barCancelButton,"mousedown",this);this._parent.appendChild(this.handle);this._parentWindow.gara.jswt.widgets.DialogManager.getInstance().activate(this);this._createContents(this._dialogContent);var e=this;var h=new gara.Class({$implements:gara.jswt.events.KeyListener,keyPressed:function(a){},keyReleased:function(a){if(a.keyCode==gara.jswt.JSWT.ESC){e.dispose()}}});function f(c){if(gara.instanceOf(c,gara.jswt.widgets.Composite)){c.getChildren().forEach(function(a){if(gara.instanceOf(a,gara.jswt.widgets.Control)){a.addKeyListener(h)}f(a)},e)}}f(this._dialogContent);function g(c){if(gara.instanceOf(c,gara.jswt.widgets.Composite)){c.getChildren().forEach(function(a){if(gara.instanceOf(a,gara.jswt.widgets.Control)){return a.forceFocus()}g(a)},e)}}g(this._dialogContent)},_createContents:gara.abstract(function(){}),_disableTabIndexes:function(){var a=0;for(var c=0;c<this._tabbableTags.length;c++){var b=this._parentWindow.document.getElementsByTagName(this._tabbableTags[c]);for(var d=0;d<b.length;d++){this._tabIndexes[a]=b[d].tabIndex;this._tabIndexElements[a]=b[d];b[d].tabIndex="-1";a++}}},dispose:function(){this.$base();this._parentWindow.gara.EventManager.removeListener(this.handle,"mousedown",this);this._parentWindow.gara.EventManager.removeListener(this._barCancelButton,"mousedown",this);this._parentWindow.gara.EventManager.removeListener(window,"resize",this);this._parentWindow.gara.jswt.widgets.DialogManager.getInstance().removeDialog(this);this.handle.widget=null;this._parent.removeChild(this.handle);if((this._style&gara.jswt.JSWT.APPLICATION_MODAL)==gara.jswt.JSWT.APPLICATION_MODAL){this._parentWindow.document.getElementById("jsWTModalLayer").style.display="none"}this._disposed=true;if((this._style&gara.jswt.JSWT.APPLICATION_MODAL)==gara.jswt.JSWT.APPLICATION_MODAL){this._restoreTabIndexes()}},getText:function(){return this._text},getStyle:function(){return this._style},_getViewportHeight:function(){if(this._parentWindow.innerHeight!=window.undefined)return this._parentWindow.innerHeight;if(this._parentWindow.document.compatMode=='CSS1Compat')return this._parentWindow.document.documentElement.clientHeight;if(this._parentWindow.document.body)return this._parentWindow.document.body.clientHeight;return window.undefined},_getViewportWidth:function(){if(this._parentWindow.innerWidth!=window.undefined)return this._parentWindow.innerWidth;if(this._parentWindow.document.compatMode=='CSS1Compat')return this._parentWindow.document.documentElement.clientWidth;if(this._parentWindow.document.body)return this._parentWindow.document.body.clientWidth;return window.undefined},handleEvent:function(a){switch(a.type){case"mousedown":this._parentWindow.gara.jswt.widgets.DialogManager.getInstance().activate(this);if(a.target==this._barCancelButton){this.dispose()}else if(a.target==this._dialogBar||a.target==this._dialogBarTitle||a.target==this._dialogBarButtons){this._parentWindow.gara.EventManager.addListener(this._parentWindow.document,"mousemove",this);this._parentWindow.gara.EventManager.addListener(this._dialogBar,"mouseup",this);this._dX=a.clientX-this.handle.offsetLeft;this._dY=a.clientY-this.handle.offsetTop}break;case"mouseup":this._parentWindow.gara.EventManager.removeListener(this._parentWindow.document,"mousemove",this);this._parentWindow.gara.EventManager.removeListener(this._dialogBar,"mouseup",this);break;case"mousemove":this.handle.style.left=(a.clientX-this._dX)+"px";this.handle.style.top=(a.clientY-this._dY)+"px";break;case"keydown":console.log("Dialog.handleEvent(keydown): "+a.keyCode);break;case"resize":break}},isDisposed:function(){return this._disposed},open:gara.abstract(function(){}),_registerListener:function(){},_restoreTabIndexes:function(){for(var a=0,c=this._tabIndexElements.length;a<c;++a){this._tabIndexElements[a].tabIndex=this._tabIndexes[a]}this._tabIndexes=[];this._tabIndexElements=[]},setText:function(a){this._text=a;if(this._dialogBarText){this._dialogBarText.nodeValue=a}},_unregisterListener:function(){}});