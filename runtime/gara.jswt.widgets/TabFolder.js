gara.provide("gara.jswt.widgets.TabFolder");gara.use("gara.EventManager");gara.use("gara.jswt.JSWT");gara.use("gara.jswt.widgets.Menu");gara.use("gara.jswt.widgets.MenuItem");gara.parent("gara.jswt.widgets.Composite",function(){gara.Class("gara.jswt.widgets.TabFolder",{$extends:gara.jswt.widgets.Composite,items:[],recents:[],activeItem:null,selectionListeners:[],selection:[],imageQueue:[],dropDownMenu:null,more:null,moreText:null,tabbar:null,clientArea:null,$constructor:function(a,b){this.items=[];this.recents=[];this.activeItem=null;this.selectionListeners=[];this.selection=[];this.imageQueue=[];this.event=null;this.dropDownMenu=null;this.more=null;this.moreText=null;this.tabbar=null;this.clientArea=null;b=b||gara.jswt.JSWT.TOP|gara.jswt.JSWT.DROP_DOWN;if(!((b&gara.jswt.JSWT.TOP)===gara.jswt.JSWT.TOP)&&!((b&gara.jswt.JSWT.BOTTOM)===gara.jswt.JSWT.BOTTOM)){b|=gara.jswt.JSWT.TOP}if(!((b&gara.jswt.JSWT.MULTI)===gara.jswt.JSWT.MULTI)&&!((b&gara.jswt.JSWT.DROP_DOWN)===gara.jswt.JSWT.DROP_DOWN)){b|=gara.jswt.JSWT.DROP_DOWN}this.$super(a,b)},addItem:function(a){this.checkWidget();if(!(a instanceof gara.jswt.widgets.TabItem)){throw new TypeError("item is not type of gara.jswt.widgets.TabItem");}this.items.push(a);this.recents.push(a);if(this.activeItem===null){this.activeItem=a;this.activeItem.setActive(true);this.selection=[];this.selection.push(this.activeItem)}return this.tabbar},addSelectionListener:function(a){this.checkWidget();if(!this.selectionListeners.contains(a)){this.selectionListeners.push(a)}},activateItem:function(a){this.checkWidget();if(!(a instanceof gara.jswt.widgets.TabItem)){throw new TypeError("item is not type of gara.jswt.widgets.TabItem");}if(this.activeItem!==null){this.activeItem.setActive(false)}this.recents.remove(a);this.recents.insertAt(0,a);this.activeItem=a;this.activeItem.setActive(true);this.tabbar.setAttribute("aria-activedescendant",this.activeItem.getId());this.updateMeasurements();if(this.activeItem.getControl()!==null&&this.activeItem.getControl()instanceof gara.jswt.widgets.Scrollable){this.activeItem.getControl().setHeight(this.clientArea.offsetHeight-gara.getNumStyle(this.clientArea,"border-top-width")-gara.getNumStyle(this.clientArea,"border-bottom-width")-gara.getNumStyle(this.clientArea,"padding-top")-gara.getNumStyle(this.clientArea,"padding-bottom"));this.activeItem.getControl().setWidth(this.clientArea.offsetWidth-gara.getNumStyle(this.clientArea,"border-left-width")-gara.getNumStyle(this.clientArea,"border-right-width")-gara.getNumStyle(this.clientArea,"padding-left")-gara.getNumStyle(this.clientArea,"padding-right"));this.activeItem.getControl().update()}this.selection=[];this.selection.push(a);this.notifySelectionListener()},bindListener:function(a,b){gara.EventManager.addListener(this.handle,a,b)},createWidget:function(){this.createHandle("div");this.addClass("jsWTTabFolder");this.addListener("mousedown",this);this.tabbar=document.createElement("ul");this.tabbar.id=this.getId()+"-tablist";this.tabbar.widget=this;this.tabbar.control=this;this.tabbar.className="jsWTTabFolderBar";this.tabbar.setAttribute("role","tablist");this.clientArea=document.createElement("div");this.clientArea.className="jsWTTabClientArea";if((this.style&gara.jswt.JSWT.TOP)===gara.jswt.JSWT.TOP){this.handle.appendChild(this.tabbar);this.handle.appendChild(this.clientArea);this.addClass("jsWTTabFolderTopbar")}else{this.handle.appendChild(this.clientArea);this.handle.appendChild(this.tabbar);this.addClass("jsWTTabFolderBottombar")}if((this.style&gara.jswt.JSWT.DROP_DOWN)===gara.jswt.JSWT.DROP_DOWN){this.more=document.createElement("span");this.moreText=document.createTextNode("");this.more.className="more";this.more.style.display="none";this.handle.appendChild(this.more);this.more.appendChild(this.moreText);gara.EventManager.addListener(this.more,"mousedown",this);this.dropDownMenu=new gara.jswt.widgets.Menu(this,gara.jswt.JSWT.DROP_DOWN)}},dispose:function(){this.$super();this.items.forEach(function(a,b,c){a.dispose()},this);this.handle.removeChild(this.tabbar);this.handle.removeChild(this.clientArea);if(this.parentNode!==null){this.parentNode.removeChild(this.handle)}delete this.tabbar;delete this.clientArea;delete this.handle},getDropDownMenu:function(){return this.dropDownMenu},getItem:function(a){this.checkWidget();if(typeof(this.items.indexOf(a))=="undefined"){throw new RangeError("There is no item for the given index");}return this.items[a]},getItemCount:function(){return this.items.length},getItems:function(){return this.items},getSelection:function(){this.checkWidget();return this.selection},getSelectionIndex:function(){this.checkWidget();if(this.selection.length){return this.items.indexOf(this.selection[0])}else{return-1}},getTabbar:function(){return this.tabbar},handleEvent:function(a){this.checkWidget();var b=a.target.widget||null;a.item=b&&b instanceof gara.jswt.widgets.TabItem?b:this.activeItem;a.widget=this;this.event=a;this.handleMouseEvents(a);if(this.menu!==null&&this.menu.isVisible()){this.menu.handleEvent(a)}else{this.handleKeyEvents(a);this.handleMenu(a)}this.$super(a);if(a.item!==null){a.item.handleEvent(a)}a.stopPropagation();return false},handleMouseEvents:function(a){switch(a.type){case"mousedown":if(a.target===this.more){this.dropDownMenu.setLocation(this.more.offsetLeft,this.more.offsetTop+this.more.offsetHeight+1);this.dropDownMenu.setVisible(true)}else{this.activateItem(a.item)}break}},handleKeyEvents:function(a){switch(a.type){case"keydown":this.handleKeyNavigation(a);break}},handleKeyNavigation:function(a){var b,c;switch(a.keyCode){case gara.jswt.JSWT.ARROW_LEFT:if(this.activeItem!==null){c=this.indexOf(this.activeItem)-1;if(c>=0){this.activateItem(this.items[c])}}break;case gara.jswt.JSWT.ARROW_RIGHT:if(this.activeItem!==null){b=this.indexOf(this.activeItem)+1;if(b<this.items.length){this.activateItem(this.items[b])}}break;case gara.jswt.JSWT.HOME:if(this.items.length){this.activateItem(this.items[0])}break;case gara.jswt.JSWT.END:if(this.items.length){this.activateItem(this.items[this.items.length-1])}break}},indexOf:function(a){this.checkWidget();if(!(a instanceof gara.jswt.widgets.TabItem)){throw new TypeError("item not instance of gara.jswt.widgets.TabItem");}return this.items.indexOf(a)},notifySelectionListener:function(){this.selectionListeners.forEach(function(a){if(a.widgetSelected){a.widgetSelected(this.event)}},this)},remeasureItems:function(a){a.width+=a.getImage().width;this.imageQueue.remove(a);if(!this.imageQueue.length){this.updateMeasurements()}},remove:function(a){this.checkWidget();if(!(a instanceof gara.jswt.widgets.TabItem)){throw new TypeError("item not instance of gara.jswt.widgets.TabItem");}this.items.remove(a);if(this.selection.contains(a)){this.selection.remove(a)}a.dispose();delete a},removeIndex:function(a){var b;this.checkWidget();if(typeof(this.items.indexOf(a))=="undefined"){throw new RangeError("There is no item for the given index");}b=this.items.removeAt(a)[0];if(this.selection.contains(b)){this.selection.remove(b)}b.dispose();delete b},removeRange:function(a,b){for(var c=a;c<=b;++c){this.removeIndex(c)}},removeFromArray:function(b){b.forEach(function(a){this.removeIndex(a)},this)},removeAll:function(){this.checkWidget();while(this.items.length){this.removeIndex(0)}},removeSelectionListener:function(a){this.checkWidget();this.selectionListeners.remove(a)},scrolledHandle:function(){return this.clientArea},setHeight:function(a){var b;this.$super(a);this.updateMeasurements();if(this.activeItem!==null&&this.activeItem.getControl()!==null&&this.activeItem.getControl()instanceof gara.jswt.widgets.Scrollable){b=this.clientArea.offsetHeight-gara.getNumStyle(this.clientArea,"border-top-width")-gara.getNumStyle(this.clientArea,"border-bottom-width")-gara.getNumStyle(this.clientArea,"padding-top")-gara.getNumStyle(this.clientArea,"padding-bottom");this.activeItem.getClientArea().style.height=b+"px";this.activeItem.getControl().setHeight(b)}return this},setSelectionItem:function(a){this.checkWidget();if(typeof(this.items.indexOf(index))=="undefined"){throw new RangeError("There is no item for the given index");}this.activateItem(this.items[index]);return this},setSelectionIndex:function(a){this.checkWidget();if(typeof(this.items.indexOf(a))=="undefined"){throw new RangeError("There is no item for the given index");}this.activateItem(this.items[a]);return this},setSelectionFromArray:function(a){this.checkWidget();if(a.length){this.activateItem(a[0])}return this},setWidth:function(a){var b;this.$super(a);this.updateMeasurements();if(this.activeItem!==null){var b=this.clientArea.offsetWidth-gara.getNumStyle(this.clientArea,"border-left-width")-gara.getNumStyle(this.clientArea,"border-right-width")-gara.getNumStyle(this.clientArea,"padding-left")-gara.getNumStyle(this.clientArea,"padding-right");this.activeItem.getClientArea().style.width=b+"px";if(this.activeItem.getControl()!==null&&this.activeItem.getControl()instanceof gara.jswt.widgets.Scrollable){this.activeItem.getControl().setWidth(b)}}return this},unbindListener:function(a,b){gara.EventManager.removeListener(this.handle,a,b)},update:function(){this.checkWidget();this.updateMeasurements()},updateMeasurements:function(){var c,d=0,f=1,e=0,i=false,g,h;this.handle.style.width=this.width!==null?this.width+"px":"auto";this.handle.style.height=this.height!==null?this.height+"px":"auto";this.tabbar.style.width=this.width!==null?this.width+"px":"auto";c=this.width!==null?this.width:this.handle.clientWidth;g=(this.style&gara.jswt.JSWT.DROP_DOWN)===gara.jswt.JSWT.DROP_DOWN?this.recents:this.items;if((this.style&gara.jswt.JSWT.DROP_DOWN)===gara.jswt.JSWT.DROP_DOWN){h=this.more.style.display;this.more.style.display="block";c=this.more.offsetLeft-gara.getNumStyle(this.more,"margin-left");this.more.style.display=h}g.forEach(function(a){var b=this;if(a.isDisposed()){this.remove(index)}else{a.handle.style.display="block";a.update();a.width=a.handle.offsetWidth;if(!a.width){if(a.getImage()!==null&&navigator.userAgent.toLowerCase().indexOf("webkit")!==-1){this.imageQueue.push(a);a.getImage().onload=function(){b.remeasureItems(a)}}}if((this.style&gara.jswt.JSWT.MULTI)===gara.jswt.JSWT.MULTI){if(d+a.handle.offsetWidth>c){f++;d=a.handle.offsetWidth}else{d+=a.handle.offsetWidth}}if((this.style&gara.jswt.JSWT.DROP_DOWN)===gara.jswt.JSWT.DROP_DOWN){if(d+a.width>c){e++}d+=a.width;if(e){a.handle.style.display="none";a.getData("gara__menuItem").setVisible(true)}else{a.handle.style.display="block";a.getData("gara__menuItem").setVisible(false)}}}},this);if((this.style&gara.jswt.JSWT.MULTI)===gara.jswt.JSWT.MULTI&&f>1){this.tabbar.style.height=((this.items[0].handle.offsetHeight*f)-1)+"px"}if((this.style&gara.jswt.JSWT.DROP_DOWN)===gara.jswt.JSWT.DROP_DOWN&&e){this.moreText.nodeValue=e;this.more.style.display="block"}else if((this.style&gara.jswt.JSWT.DROP_DOWN)===gara.jswt.JSWT.DROP_DOWN&&!e){this.more.style.display="none"}if(this.height!==null){this.clientArea.style.height=(this.height-(this.tabbar.offsetHeight+gara.getNumStyle(this.tabbar,"margin-top")+gara.getNumStyle(this.tabbar,"margin-bottom"))-gara.getNumStyle(this.clientArea,"margin-top")-gara.getNumStyle(this.clientArea,"border-top-width")-gara.getNumStyle(this.clientArea,"border-bottom-width")-gara.getNumStyle(this.clientArea,"margin-bottom"))+"px"}if(this.width!==null){this.clientArea.style.width=this.width-gara.getNumStyle(this.clientArea,"margin-left")-gara.getNumStyle(this.clientArea,"border-left-width")-gara.getNumStyle(this.clientArea,"border-right-width")-gara.getNumStyle(this.clientArea,"margin-right")+"px"}}})});