gara.provide("gara.jswt.widgets.MenuItem");gara.use("gara.EventManager");gara.use("gara.jswt.JSWT");gara.parent("gara.jswt.widgets.Item",function(){gara.Class("gara.jswt.widgets.MenuItem",{$extends:gara.jswt.widgets.Item,enabled:true,hr:null,img:null,menu:null,selected:false,selectionListeners:[],span:null,spanText:null,visible:true,$constructor:function(a,b,c){if(!(a instanceof gara.jswt.widgets.Menu)){throw new TypeError("parent is not type of gara.jswt.widgets.Menu");}this.$super(a,b);this.parentNode=this.parent.addItem(this,c);this.span=null;this.spanText=null;this.img=null;this.hr=null;this.selectionListeners=[];this.menu=null;this.enabled=true;this.visible=true;this.selected=false;this.createWidget()},addSelectionListener:function(a){this.checkWidget();if(!this.selectionListeners.contains(a)){this.selectionListeners.push(a)}},bindListener:function(a,b){gara.EventManager.addListener(this.handle,a,b)},createWidget:function(){var a,b,c,d;this.handle=document.createElement("li");this.handle.widget=this;this.handle.control=this.parent;this.handle.className=this.classes.join(" ");this.handle.style.display=this.visible?"block":"none";this.handle.setAttribute("id",this.getId());this.handle.setAttribute("role","menuitem");this.handle.setAttribute("aria-disabled",!this.enabled);this.handle.setAttribute("aria-labelledby",this.getId()+"-label");if((this.style&gara.jswt.JSWT.SEPARATOR)===gara.jswt.JSWT.SEPARATOR){this.handle.className="jsWTMenuItemSeparator";if((this.parent.getStyle()&gara.jswt.JSWT.BAR)!==gara.jswt.JSWT.BAR){this.hr=document.createElement("hr");this.handle.appendChild(this.hr);this.handle.setAttribute("aria-disabled",true)}}else{if((this.style&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO){this.handle.setAttribute("role","menuitemradio")}if((this.style&gara.jswt.JSWT.CHECK)===gara.jswt.JSWT.CHECK){this.handle.setAttribute("role","menuitemcheckbox")}if((this.style&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO||(this.style&gara.jswt.JSWT.CHECK)===gara.jswt.JSWT.CHECK){this.handle.setAttribute("aria-checked",this.selected)}c=document.createElement("span");c.className="button";c.widget=this;c.control=this.parent;c.setAttribute("role","presentation");d=document.createElement("span");d.className="door";d.widget=this;d.control=this.parent;d.setAttribute("role","presentation");this.img=document.createElement("img");this.img.id=this.getId()+"-image";this.img.widget=this;this.img.control=this.parent;this.img.setAttribute("role","presentation");if(this.image!==null){this.img.src=this.image.src}else{this.img.style.display="none"}this.spanText=document.createTextNode(this.text);this.span=document.createElement("span");this.span.id=this.getId()+"-label";this.span.role="presentation";this.span.widget=this;this.span.control=this.parent;this.span.className="text";this.span.appendChild(this.spanText);this.span.setAttribute("role","presentation");d.appendChild(this.img);d.appendChild(this.span);c.appendChild(d);this.handle.appendChild(c);this.handle.setAttribute("aria-haspopup",((this.style&gara.jswt.JSWT.CASCADE)===gara.jswt.JSWT.CASCADE)&&this.menu!==null);this.setClass("jsWTMenuItemCascade",((this.style&gara.jswt.JSWT.CASCADE)===gara.jswt.JSWT.CASCADE)&&this.menu!==null);this.setClass("jsWTMenuItemCheck",(this.style&gara.jswt.JSWT.CHECK)===gara.jswt.JSWT.CHECK);this.setClass("jsWTMenuItemRadio",(this.style&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO)}a=this.parent.indexOf(this);b=a===0?this.parentNode.firstChild:this.parent.getItems()[a-1].handle.nextSibling;if(!b){this.parentNode.appendChild(this.handle)}else{this.parentNode.insertBefore(this.handle,b)}},dispose:function(){this.$super();if(this.menu!==null){this.menu.dispose();delete this.menu}if(this.img!==null){this.handle.removeChild(this.img);delete this.img;delete this.image}if(this.hr!==null){this.handle.removeChild(this.hr);delete this.hr}if(this.span!==null){this.handle.removeChild(this.span);delete this.span;delete this.text}this.parentNode.removeChild(this.handle);delete this.handle},getEnabled:function(){return this.enabled},getMenu:function(){return this.menu},getParent:function(){return this.parent},getSelection:function(){return this.selected},getVisible:function(){return this.visible},handleEvent:function(a){if((this.style&gara.jswt.JSWT.SEPARATOR)!==gara.jswt.JSWT.SEPARATOR){switch(a.type){case"mousedown":this.handle.setAttribute("aria-pressed",true);break;case"mouseup":this.handle.setAttribute("aria-pressed",false);break}}},removeSelectionListener:function(a){this.checkWidget();this.selectionListeners.remove(a)},setEnabled:function(a){this.enabled=a;if(this.handle!==null){this.handle.setAttribute("aria-disabled",!this.enabled)}return this},setImage:function(a){this.$super(a);if(this.handle){if(this.image!==null){this.img.src=this.image.src;this.img.style.display=""}else{this.img.src="";this.img.style.display="none"}}return this},setMenu:function(a){this.checkWidget();if(!(a instanceof gara.jswt.widgets.Menu)){throw new TypeError("menu is not instance of gara.jswt.widgets.Menu");}this.menu=a;this.setClass("jsWTMenuItemCascade",((this.style&gara.jswt.JSWT.CASCADE)===gara.jswt.JSWT.CASCADE)&&this.menu!==null);this.menu.update();this.handle.setAttribute("aria-haspopup",((this.style&gara.jswt.JSWT.CASCADE)===gara.jswt.JSWT.CASCADE)&&this.menu!==null);return this},setSelection:function(d){if(this.enabled){var g={item:this,widget:this.parent};if(((this.style&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO||(this.style&gara.jswt.JSWT.CHECK)===gara.jswt.JSWT.CHECK)){this.selected=d;this.handle.setAttribute("aria-checked",this.selected)}if((this.style&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO){if(!this.parent.managingRadioChecks){this.parent.managingRadioChecks=true;var f=this.parent.indexOf(this);var e=f-1;while(e>=0&&(this.parent.getItem(e).getStyle()&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO){this.parent.getItem(e--).setSelection(false)}e=f+1;while(e<this.parent.getItems().length&&(this.parent.getItem(e).getStyle()&gara.jswt.JSWT.RADIO)===gara.jswt.JSWT.RADIO){this.parent.getItem(e++).setSelection(false)}this.parent.managingRadioChecks=false}}this.selectionListeners.forEach(function(a,b,c){if(a.widgetSelected){a.widgetSelected(g)}},this)}return this},setText:function(a){this.$super(a);if(this.handle&&(this.style&gara.jswt.JSWT.SEPARATOR)!==gara.jswt.JSWT.SEPARATOR){this.spanText.nodeValue=this.text}return this},setVisible:function(a){this.visible=a;this.changed=true;this.handle.style.display=this.visible?"block":"none";return this},unbindListener:function(a,b){gara.EventManager.removeListener(this.handle,a,b)},update:function(){this.checkWidget();if(!this.handle){this.createWidget()}if(this.menu!==null){this.menu.update()}}})});