gara.provide("gara.widgets.TableItem","gara.widgets.Item");gara.use("gara.widgets.Table");gara.Class("gara.widgets.TableItem",function(){return{$extends:gara.widgets.Item,cells:[],checkboxTd:null,checkbox:null,active:false,checked:false,grayed:false,selected:false,$constructor:function(b,a,d){if(!(b instanceof gara.widgets.Table)){throw new TypeError("parent is not a gara.widgets.Table");}this.$super(b,a);this.parentNode=this.parent.addItem(this,d);this.cells=[];this.checkboxTd=null;this.checkbox=null;this.active=false;this.checked=false;this.grayed=false;this.selected=false;this.createWidget()},adjustWidth:function(b,a){var d=this.parent.getColumnOrder(),e,c;if(b){c=this.cells[this.parent.getColumns().indexOf(b)];if(c&&c.handle){c.wrapper.style.width=(a-gara.getNumStyle(c.wrapper,"border-left-width")-gara.getNumStyle(c.wrapper,"border-right-width"))+"px"}}},bindListener:function(b,a){gara.addEventListener(this.handle,b,a)},clear:function(){this.checkWidget();this.text="";this.image=null;this.cells=[];this.active=this.checked=this.selected=this.grayed=false},createWidget:function(){var b,a;this.handle=document.createElement("tr");this.handle.id=this.getId();this.handle.widget=this;this.handle.control=this.parent;this.handle.setAttribute("role","row");this.addClass("garaTableItem");if((this.parent.getStyle()&gara.CHECK)===gara.CHECK){this.checkbox=document.createElement("span");this.checkbox.widget=this;this.checkbox.control=this.tree;this.setCheckboxClass();this.checkbox.setAttribute("role","presentation");this.checkboxTd=document.createElement("td");this.checkboxTd.className="garaTableItemCell garaCheckboxCell";this.checkboxTd.appendChild(this.checkbox);this.checkboxTd.setAttribute("role","presentation");this.handle.appendChild(this.checkboxTd);this.handle.setAttribute("aria-checked",this.checked)}if(!this.parent.getColumnCount()&&this.parent.virtualColumn===null){this.parent.update()}this.update();this.parentNode.appendChild(this.handle);this.parent.updateMeasurements()},createCell:function(b){if(this.cells[b]){return this.cells[b]}var a={};a.handle=document.createElement("td");a.handle.role="gridcell";a.handle.className="garaTableItemCell";a.handle.widget=this;a.handle.control=this.parent;a.index=b;a.handle.setAttribute("aria-labelledby",this.getId()+"-label-"+b);a.wrapper=document.createElement("div");a.wrapper.role="presentation";a.wrapper.className="garaTableItemCellWrapper";a.wrapper.widget=this;a.wrapper.control=this.parent;a.handle.appendChild(a.wrapper);a.img=document.createElement("img");a.img.id=this.getId()+"-image-"+b;a.img.widget=this;a.img.control=this.parent;a.img.className="garaItemImage garaTableItemImage";a.img.setAttribute("role","presentation");a.img.style.display="none";a.wrapper.appendChild(a.img);a.textNode=document.createTextNode("");a.span=document.createElement("span");a.span.id=this.getId()+"-label-"+b;a.span.className="garaItemText garaTableItemText";a.span.widget=this;a.span.control=this.parent;a.span.setAttribute("role","presentation");a.span.appendChild(a.textNode);a.wrapper.appendChild(a.span);return a},destroyWidget:function(){this.parent.releaseItem(this);this.cells=null;this.$super()},getCell:function(b){if(!this.cells[b]){this.cells[b]=this.createCell(b)}return this.cells[b]},getChecked:function(){this.checkWidget();return this.checked},getGrayed:function(){this.checkWidget();return this.grayed},getText:function(b){this.checkWidget();if(this.cells[b]){return this.cells[b].text}return null},getImage:function(b){this.checkWidget();if(this.cells[b]){return this.cells[b].image}return null},handleEvent:function(b){this.checkWidget();if((b.target===this.checkbox&&b.type==="mousedown")||(b.target===this.checkbox&&b.type==="mouseup")||(b.type==="keydown"&&b.keyCode===gara.SPACE)){b.info=gara.CHECK;if(b.type==="mouseup"){this.setChecked(!this.checked)}}},setCheckboxClass:function(){this.checkbox.className="garaCheckbox";if(this.checked&&this.grayed){this.checkbox.className+=" garaCheckboxGrayedChecked"}else if(this.grayed){this.checkbox.className+=" garaCheckboxGrayed"}else if(this.checked){this.checkbox.className+=" garaCheckboxChecked"}},setChecked:function(b){if(!this.grayed){this.checked=b;this.handle.setAttribute("aria-checked",this.checked);this.setCheckboxClass()}return this},setGrayed:function(b){this.grayed=b;this.checkbox.setAttribute("aria-disabled",this.grayed);this.setCheckboxClass();return this},setImage:function(e,c){var f=this,g=function(b,a){var d=f.getCell(b);d.image=a;if(a!==null){d.img.src=a.src;d.img.style.display=""}else{d.img.src="";d.img.style.display="none"}};this.checkWidget();if(!c){c=e;e=0}if(typeof(c)==="undefined"){return}if(c instanceof Array){c.forEach(function(b,a,d){g(a,b)},this)}else{g(e,c)}return this},setSelected:function(b){this.checkWidget();this.selected=b;this.handle.setAttribute('aria-selected',this.selected)},setText:function(e,c){var f=this,g=function(b,a){var d=f.getCell(b);d.text=a;d.textNode.nodeValue=a};this.checkWidget();if(typeof(c)==="undefined"){c=e;e=0}if(c instanceof Array){c.forEach(function(b,a,d){g(a,b)},this)}else{g(e,c)}return this},unbindListener:function(b,a){gara.removeEventListener(this.handle,b,a)},update:function(){var b,a,d,e,c,f=false;this.checkWidget();if(this.handle===null){this.createWidget()}else{while(this.handle.childNodes.length){this.handle.removeChild(this.handle.childNodes[0])}if((this.parent.getStyle()&gara.CHECK)!==0){this.handle.appendChild(this.checkboxTd)}b=this.parent.getColumnOrder(),c=this.parent.getColumns();virtual=b.length===0;for(a=0,e=b.length||1;a<e;a++){if(virtual||c[b[a]].getVisible()){d=this.getCell(virtual?0:b[a]);d.handle.className="garaTableItemCell "+(!f?"garaFirstTableItemCell":"");this.handle.appendChild(d.handle);f=true}}}}}});