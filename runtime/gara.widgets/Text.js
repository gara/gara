gara.provide("gara.widgets.Text","gara.widgets.Scrollable");gara.Class("gara.widgets.Text",function(){return{$extends:gara.widgets.Scrollable,multi:false,modifyListeners:[],selectionListeners:[],$constructor:function(a,b){this.multi=(b&gara.MULTI)===gara.MULTI;this.lastValue="";this.modifyListeners=[];this.selectionListeners=[];this.$super(a,b||gara.SINGLE)},addModifyListener:function(a){this.checkWidget();if(!this.modifyListeners.contains(a)){this.modifyListeners.push(a)}return this},addSelectionListener:function(a){this.checkWidget();if(!this.selectionListeners.contains(a)){this.selectionListener.push(a)}return this},append:function(a){this.handle.value+=a;this.lastValue=this.handle.value;this.notifyModifyListener()},bindListener:function(a,b){gara.addEventListener(this.handle,a,b)},createWidget:function(){var c;this.createHandle(this.multi?"textarea":"input");if(!this.multi){c=this.handle.cloneNode(false);c.type=(this.style&gara.PASSWORD)===gara.PASSWORD?"password":"text";this.handle.parentNode.replaceChild(c,this.handle);this.handle=c;this.handle.widget=this;for(eventType in this.listeners){this.listeners[eventType].forEach(function(a,b,d){this.bindListener(eventType,a)},this)}}this.handle.readOnly=(this.style&gara.READ_ONLY)===gara.READ_ONLY;this.handle.setAttribute("role","textbox");this.handle.setAttribute("aria-disabled",!this.enabled);this.handle.setAttribute("aria-multiline",(this.style&gara.SINGLE)!==gara.SINGLE);this.handle.setAttribute("aria-readonly",this.handle.readOnly);this.addClass(this.multi?"garaMultiText":((this.style&gara.PASSWORD)===gara.PASSWORD?"garaPassword":"garaText"));this.addKeyListener(this)},destroyWidget:function(){this.modifyListeners=null;this.selectionListeners=null;this.$super()},getSelection:function(){return{x:this.handle.selectionStart,y:this.handle.selectionEnd}},getSelectionCount:function(){return this.handle.selectionEnd-this.handle.selectionStart},getSelectionText:function(){return this.handle.value.substring(this.handle.selectionStart,this.handle.selectionEnd)},getText:function(){return this.handle.value},handleEvent:function(a){this.checkWidget();if(!this.enabled){return}a.widget=this;this.event=a;if(this.menu!==null&&this.menu.isVisible()){this.menu.handleEvent(a)}else{this.handleMenu(a)}this.$super(a);a.stopPropagation();return false},keyReleased:function(a){if(this.handle.value!==this.lastValue){this.notifyModifyListener()}this.lastValue=this.handle.value},notifyModifyListener:function(){this.modifyListeners.forEach(function(a){if(a.modifyText){a.modifyText(this.event)}},this)},notifySelectionListener:function(){this.selectionListener.forEach(function(a){if(a.widgetSelected){a.widgetSelected(this.event)}},this)},removeModifyListener:function(a){this.checkWidget();this.modifyListeners.remove(a);return this},removeSelectionListener:function(a){this.checkWidget();this.selectionListeners.remove(a);return this},selectAll:function(){this.handle.select()},setSelection:function(a,b){this.checkWidget();a=a||0;b=b||this.handle.value.length;this.handle.setSelectionRange(a,b);this.notifySelectionListener();return this},setText:function(a){this.handle.value=a;this.lastValue=this.handle.value;this.notifyModifyListener();return this},unbindListener:function(a,b){gara.removeEventListener(this.handle,a,b)},update:function(){this.checkWidget()}}});