gara.provide("gara.widgets.TableColumn","gara.widgets.Item");gara.use("gara.widgets.TableItem");gara.use("gara.widgets.Table");gara.use("gara.widgets.MenuItem");gara.Class("gara.widgets.TableColumn",function(){return{$extends:gara.widgets.Item,shadow:null,width:0,img:null,span:null,spanText:null,resizer:null,moveable:true,resizable:true,isMoving:false,isResizing:false,$constructor:function(e,b,c){var f;if(!(e instanceof gara.widgets.Table)){throw new TypeError("parent is not a gara.widgets.Table");}this.$super(e,b);this.parentNode=this.parent.addColumn(this,c);this.shadow=null;this.minWidth=17;this.width=null;this.img=null;this.span=null;this.spanText=null;this.resizer=null;this.moveable=true;this.resizable=true;this.visible=true;f={widgetSelected:function(d){var g=0;d.widget.getData().getColumns().forEach(function(a){if(a.getVisible()){g++}});d.item.removeSelectionListener(f);if(g===1&&!d.item.getSelection()){d.item.setSelection(true)}else{d.item.getData().setVisible(!d.item.getData().getVisible())}d.item.addSelectionListener(f);d.widget.getData().setFocus()}};this.colMenuItem=new gara.widgets.MenuItem(this.parent.colMenu,gara.CHECK).setSelection(true).setData(this);this.colMenuItem.addSelectionListener(f);this.isMoving=false;this.isResizing=false;this.createWidget()},adjustWidth:function(a){a=a<this.minWidth?this.minWidth:a;if(a===null){this.col.removeAttribute("width")}else{this.col.width=a}a=a-gara.getNumStyle(this.handle,"padding-left")-gara.getNumStyle(this.handle,"padding-right")-gara.getNumStyle(this.handle,"border-left-width")-gara.getNumStyle(this.handle,"border-right-width");this.handle.style.width=a+"px";this.span.style.width=(a-(this.image!==null?this.img.offsetWidth:0)-gara.getNumStyle(this.span,"padding-left")-gara.getNumStyle(this.span,"padding-right")-gara.getNumStyle(this.span,"margin-left")-this.resizer.offsetWidth)+"px";this.parent.adjustedColWidth(this,this.handle.offsetWidth)},bindListener:function(){},createWidget:function(){var e,b,c,f,h,i,j,k;this.handle=document.createElement("th");this.handle.id=this.getId();this.handle.widget=this;this.handle.control=this.parent;this.handle.setAttribute("role","columnheader");this.handle.setAttribute("aria-labelledby",this.getId()+"-label");this.handle.setAttribute("unselectable","on");this.addClass("garaTableHeadColumn");this.img=document.createElement("img");this.img.id=this.getId()+"-image";this.img.widget=this;this.img.control=this.tree;this.img.className="garaItemImage garaTableColumnImage";this.img.setAttribute("role","presentation");this.img.setAttribute("unselectable","on");if(this.image!==null){this.img.src=this.image.src}else{this.img.style.display="none"}this.resizer=document.createElement("span");this.resizer.className="garaTableColumnResizer";this.resizer.id=this.getId()+"-resizer";this.resizer.widget=this;this.resizer.control=this.parent;this.resizer.setAttribute("role","presentation");this.resizer.setAttribute("unselectable","on");this.span=document.createElement("div");this.span.id=this.getId()+"-label";this.span.widget=this;this.span.control=this.parent;this.span.className="garaItemText garaTableColumnText";this.spanText=document.createTextNode(this.text);this.span.appendChild(this.spanText);this.span.setAttribute("role","presentation");this.span.setAttribute("unselectable","on");this.handle.appendChild(this.img);this.handle.appendChild(this.resizer);this.handle.appendChild(this.span);this.col=document.createElement("col");this.parent.colGroup.appendChild(this.col);if(this.parentNode!==null){e=this.parentNode.parentNode;e.style.position="relative";this.parentNode.appendChild(this.handle);b=this.parent.getColumns();c=[];f=0;colsWidths=0;k=this.parent.handle.clientWidth-gara.SCROLLBAR_WIDTH;if((this.parent.getStyle()&gara.CHECK)!==0){k-=this.parent.checkboxCell.offsetWidth}b.forEach(function(a,d){if(!a.getWidth()){c.add(a)}},this);c.forEach(function(a,d){var g;g=Math.floor(k/c.length);h+=a.adjustWidth(d===c.length-1?j-h:g)},this);e.style.position="absolute"}this.parent.updateMeasurements()},destroyWidget:function(){this.parent.releaseColumn(this);this.colMenuItem=null;this.shadow=null;this.$super()},getComputedWidth:function(){this.checkWidget();if(this.handle!==null&&this.handle.style.display!=="none"){return this.handle.offsetWidth}return 0},getMoveable:function(){return this.moveable},getMinWidth:function(){return this.minWidth},getResizable:function(){return this.resizable},getVisible:function(){return this.visible},getWidth:function(){this.checkWidget();return this.width},handleEvent:function(b){var c,f,h,i,j,k,l,n,o,q,m,r,s,p;this.checkWidget();switch(b.type){case"mousedown":if(b.target===this.resizer&&this.parent.getColumnCount()>1&&this.resizable){this.isResizing=true;this.resizeLineLeft=(this.parent.getStyle()&gara.CHECK)!==0?parseInt(this.parent.checkboxCol.width):0;this.allColsWidth=0;c=this.parent.getColumnOrder();i=this.parent.getColumns();f=i.indexOf(this);h=c.indexOf(f);c.forEach(function(a,d){var g=i[a],e=g.getComputedWidth();this.allColsWidth+=e;if(d<=h){this.resizeLineLeft+=e}},this);this.nextColumn=i[c[h+1]];this.lessColsWidth=this.allColsWidth-this.getComputedWidth()-this.nextColumn.getComputedWidth();this.resizeStart=b.clientX;this.startWidth=this.getComputedWidth();this.nextStartWidth=this.nextColumn.getComputedWidth();this.parent.resizeLine.style.display="block";this.parent.resizeLine.style.left=this.resizeLineLeft+"px";gara.addEventListener(document,"mousemove",this);gara.addEventListener(document,"mouseup",this)}if((b.target===this.handle||b.target===this.span)&&this.parent.getColumnCount()>1&&this.moveable){this.isMoving=true;c=this.parent.getColumns();j=c.indexOf(this);this.shadow=new gara.widgets.Table(document.getElementsByTagName("body")[0],this.parent.getStyle()&~gara.CHECK);this.shadow.setHeaderVisible(this.parent.getHeaderVisible());this.shadow.setLinesVisible(this.parent.getLinesVisible());this.shadow.setHeight(this.parent.handle.offsetHeight);this.shadow.setWidth(this.handle.offsetWidth);this.shadow.addClass("garaTableShadow");new gara.widgets.TableColumn(this.shadow).setText(this.getText()).setImage(this.getImage());this.parent.getItems().forEach(function(a){new gara.widgets.TableItem(this.shadow).setText(a.getText(j)).setImage(a.getImage(j))},this);if(!b.pageX){b.pageX=b.clientX+document.documentElement.scrollLeft}if(!b.pageY){b.pageY=b.clientY+document.documentElement.scrollTop}this.shadow.handle.style.left=b.pageX+16+"px";this.shadow.handle.style.top=b.pageY+16+"px";gara.addEventListener(document,"mousemove",this);gara.addEventListener(document,"mouseup",this)}break;case"mousemove":if(this.isResizing){l=b.clientX-this.resizeStart;o=this.startWidth+l;n=this.nextStartWidth-l;if(o>this.minWidth&&n>this.minWidth){this.setWidth(o);this.nextColumn.setWidth(n);this.parent.resizeLine.style.left=(this.resizeLineLeft+l)+"px"}}if(this.isMoving){if(!b.pageX){b.pageX=b.clientX+document.documentElement.scrollLeft}if(!b.pageY){b.pageY=b.clientY+document.documentElement.scrollTop}this.shadow.handle.style.left=b.pageX+16+"px";this.shadow.handle.style.top=b.pageY+16+"px"}break;case"mouseup":if(this.isResizing){gara.removeEventListener(document,"mousemove",this);gara.removeEventListener(document,"mouseup",this);this.parent.resizeLine.style.display="none";this.isResizing=false}if(this.isMoving){gara.removeEventListener(document,"mousemove",this);gara.removeEventListener(document,"mouseup",this);this.isMoving=false;this.shadow.dispose();this.shadow=null;if(b.target.widget&&b.target.widget instanceof gara.widgets.TableColumn&&b.target.widget.getParent()===this.parent){q=b.target.widget;m=this.parent.getColumnOrder();r=this.parent.getColumns().indexOf(q);s=m.indexOf(r);p=this.parent.getColumns().indexOf(this);m.remove(p);m.insertAt(s,p);this.parent.update()}}break;case"contextmenu":b.preventDefault();break}},setImage:function(a){this.$super(a);if(this.image!==null){this.img.src=this.image.src;this.img.style.display=""}else{this.img.src="";this.img.style.display="none"}this.colMenuItem.setImage(a);delete this.parent.colMenu.offsetWidth;return this},setText:function(a){this.$super(a);this.spanText.nodeValue=this.text;this.colMenuItem.setText(a);delete this.parent.colMenu.offsetWidth;return this},setMoveable:function(a){this.moveable=a;return this},setMinWidth:function(a){this.minWidth=a},setResizable:function(a){this.resizable=a;return this},setVisible:function(a){this.visible=a;this.colMenuItem.setSelection(a);this.parent.update()},setWidth:function(a){this.checkWidget();this.width=a>this.minWidth||a===null?a:this.minWidth;if(a!==null){this.adjustWidth(a)}this.parent.updateMeasurements();return this},unbindListener:function(a,d){}}});