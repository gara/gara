gara.provide("gara.widgets.MenuItem","gara.widgets.Item");gara.use("gara.widgets.Menu");gara.Class("gara.widgets.MenuItem",function(){return{$extends:gara.widgets.Item,enabled:true,hr:null,img:null,menu:null,selected:false,selectionListeners:[],span:null,spanText:null,visible:true,$constructor:function(a,c,d){var b,f;if(!(a instanceof gara.widgets.Menu)){throw new TypeError("parent is not type of gara.widgets.Menu");}this.$super(a,c);this.parentNode=this.parent.addItem(this,d);this.span=null;this.spanText=null;this.img=null;this.hr=null;this.selectionListeners=[];this.menu=null;this.enabled=true;this.visible=true;this.selected=false;this.createWidget()},addSelectionListener:function(a){this.checkWidget();if(!this.selectionListeners.contains(a)){this.selectionListeners.add(a)}return this},bindListener:function(a,c){gara.addEventListener(this.handle,a,c)},createWidget:function(){var a,c,d,b;this.handle=document.createElement("li");this.handle.widget=this;this.handle.control=this.parent;this.handle.className=this.classes.join(" ");this.handle.style.display=this.visible?"block":"none";this.handle.setAttribute("id",this.getId());this.handle.setAttribute("role","menuitem");this.handle.setAttribute("aria-disabled",!this.enabled);this.handle.setAttribute("aria-labelledby",this.getId()+"-label");this.addClass("garaMenuItem");if((this.style&gara.SEPARATOR)===gara.SEPARATOR){this.addClass("garaMenuItemSeparator");if((this.parent.getStyle()&gara.BAR)!==gara.BAR){this.hr=document.createElement("hr");this.hr.className="garaMenuItemSeparatorLine";this.handle.appendChild(this.hr);this.handle.setAttribute("aria-disabled",true)}}else{if((this.style&gara.RADIO)===gara.RADIO){this.handle.setAttribute("role","menuitemradio")}if((this.style&gara.CHECK)===gara.CHECK){this.handle.setAttribute("role","menuitemcheckbox")}if((this.style&gara.RADIO)===gara.RADIO||(this.style&gara.CHECK)===gara.CHECK){this.handle.setAttribute("aria-checked",this.selected)}d=document.createElement("span");d.className="garaMenuItemButton";d.widget=this;d.control=this.parent;d.setAttribute("role","presentation");b=document.createElement("span");b.className="garaMenuItemDoor";b.widget=this;b.control=this.parent;b.setAttribute("role","presentation");this.img=document.createElement("img");this.img.id=this.getId()+"-image";this.img.widget=this;this.img.control=this.parent;this.img.className="garaMenuItemImage garaItemImage";this.img.setAttribute("role","presentation");if(this.image!==null){this.img.src=this.image.src}else{this.img.style.display="none"}this.spanText=document.createTextNode(this.text);this.span=document.createElement("span");this.span.id=this.getId()+"-label";this.span.role="presentation";this.span.widget=this;this.span.control=this.parent;this.span.className="garaMenuItemText garaItemText";this.span.appendChild(this.spanText);this.span.setAttribute("role","presentation");b.appendChild(this.img);b.appendChild(this.span);d.appendChild(b);this.handle.appendChild(d);this.handle.setAttribute("aria-haspopup",((this.style&gara.CASCADE)===gara.CASCADE)&&this.menu!==null);this.setClass("garaMenuItemCascade",((this.style&gara.CASCADE)===gara.CASCADE)&&this.menu!==null);this.setClass("garaMenuItemCheck",(this.style&gara.CHECK)===gara.CHECK);this.setClass("garaMenuItemRadio",(this.style&gara.RADIO)===gara.RADIO)}a=this.parent.indexOf(this);c=a===0?this.parentNode.firstChild:this.parent.getItems()[a-1].handle.nextSibling;if(!c){this.parentNode.appendChild(this.handle)}else{this.parentNode.insertBefore(this.handle,c)}},destroyWidget:function(){this.parent.releaseItem(this);if(this.menu!==null){this.menu.release()}this.span=null;this.spanText=null;this.img=null;this.hr=null;this.menu=null;this.selectionListeners=null;this.$super()},getEnabled:function(){return this.enabled},getMenu:function(){return this.menu},getParent:function(){return this.parent},getSelection:function(){return this.selected},getVisible:function(){return this.visible},handleEvent:function(a){if((this.style&gara.SEPARATOR)!==gara.SEPARATOR){switch(a.type){case"mousedown":this.handle.setAttribute("aria-pressed",true);break;case"mouseup":this.handle.setAttribute("aria-pressed",false);break}}},removeSelectionListener:function(a){this.checkWidget();this.selectionListeners.remove(a);return this},setEnabled:function(a){this.enabled=a;if(this.handle!==null){this.handle.setAttribute("aria-disabled",!this.enabled)}return this},setImage:function(a){this.$super(a);if(a!==null){this.img.src=a.src;this.img.style.display=""}else{this.img.src="";this.img.style.display="none"}return this},setMenu:function(a){this.checkWidget();if(!(a instanceof gara.widgets.Menu)){throw new TypeError("menu is not instance of gara.widgets.Menu");}this.menu=a;this.setClass("garaMenuItemCascade",((this.style&gara.CASCADE)===gara.CASCADE)&&this.menu!==null);this.menu.update();this.handle.setAttribute("aria-haspopup",((this.style&gara.CASCADE)===gara.CASCADE)&&this.menu!==null);return this},setSelection:function(b){if(this.enabled){var f={item:this,widget:this.parent};if(((this.style&gara.RADIO)===gara.RADIO||(this.style&gara.CHECK)===gara.CHECK)){this.selected=b;this.handle.setAttribute("aria-checked",this.selected)}if((this.style&gara.RADIO)===gara.RADIO){if(!this.parent.managingRadioChecks){this.parent.managingRadioChecks=true;var g=this.parent.indexOf(this);var e=g-1;while(e>=0&&(this.parent.getItem(e).getStyle()&gara.RADIO)===gara.RADIO){this.parent.getItem(e--).setSelection(false)}e=g+1;while(e<this.parent.getItems().length&&(this.parent.getItem(e).getStyle()&gara.RADIO)===gara.RADIO){this.parent.getItem(e++).setSelection(false)}this.parent.managingRadioChecks=false}}this.selectionListeners.forEach(function(a,c,d){if(a.widgetSelected){a.widgetSelected(f)}},this)}return this},setText:function(a){this.$super(a);if(this.handle&&(this.style&gara.SEPARATOR)!==gara.SEPARATOR){this.spanText.nodeValue=this.text}return this},setVisible:function(a){this.visible=a;this.changed=true;this.handle.style.display=this.visible?"block":"none";return this},unbindListener:function(a,c){gara.removeEventListener(this.handle,a,c)},update:function(){this.checkWidget();if(!this.handle){this.createWidget()}if(this.menu!==null){this.menu.update()}}}});