gara.provide("gara.widgets.Button","gara.widgets.Control");gara.use("gara.widgets.Composite");gara.Class("gara.widgets.Button",function(){return{$extends:gara.widgets.Control,text:"",image:null,img:null,span:null,spanText:null,pressEvent:null,selected:false,selectionListeners:[],$constructor:function(a,b){this.text="";this.image=null;this.img=null;this.span=null;this.spanText=null;this.pressEvent=null;this.selected=false;this.selectionListeners=[];if(!((b&gara.PUSH)===gara.PUSH||(b&gara.RADIO)===gara.RADIO||(b&gara.CHECK)===gara.CHECK)){b|=gara.PUSH}if(!((b&gara.VERTICAL)===gara.VERTICAL||(b&gara.HORIZONTAL)===gara.HORIZONTAL)){b|=gara.HORIZONTAL}this.$super(a,b)},addSelectionListener:function(a){this.checkWidget();if(!this.selectionListeners.contains(a)){this.selectionListeners.push(a)}return this},bindListener:function(a,b){gara.addEventListener(this.handle,a,b)},createWidget:function(){var a,b;this.createHandle("span");this.handle.setAttribute("role","button");this.handle.setAttribute("aria-disabled",!this.enabled);this.handle.setAttribute("aria-labelledby",this.getId()+"-label");this.addClass("garaButton");this.setClass("garaButtonPush",(this.style&gara.PUSH)===gara.PUSH);this.setClass("garaButtonHorizontal",(this.style&gara.HORIZONTAL)===gara.HORIZONTAL);this.setClass("garaButtonVertical",(this.style&gara.VERTICAL)===gara.VERTICAL);if((this.style&gara.CHECK)===gara.CHECK){this.addClass("garaButtonCheckbox");this.handle.setAttribute("role","checkbox");this.handle.setAttribute("aria-checked",this.selected)}if((this.style&gara.RADIO)===gara.RADIO){this.addClass("garaButtonRadio");this.handle.setAttribute("role","radio");this.handle.setAttribute("aria-checked",this.selected)}this.addListener("mousedown",this);this.addListener("mouseup",this);a=document.createElement("span");a.widget=this;a.className="garaButtonFocus garaFocus";a.setAttribute("role","presentation");b=document.createElement("span");b.widget=this;b.className="garaButtonDoor garaDoor";b.setAttribute("role","presentation");this.img=document.createElement("img");this.img.id=this.getId()+"-image";this.img.widget=this;this.img.control=this.list;this.img.className="garaImage garaButtonImage";this.img.setAttribute("role","presentation");if(this.image!==null){this.img.src=this.image.src}else{this.img.style.display="none"}this.spanText=document.createTextNode(this.text);this.span=document.createElement("span");this.span.id=this.getId()+"-label";this.span.widget=this;this.span.control=this.list;this.span.className="garaItemText garaButtonText";this.span.appendChild(this.spanText);this.span.setAttribute("role","presentation");this.handle.appendChild(a);this.handle.appendChild(b);b.appendChild(this.img);b.appendChild(this.span)},destroyWidget:function(){this.selectionListeners=null;this.img=null;this.span=null;this.$super()},focusGained:function(a){var b,c,d,e;if((this.style&gara.RADIO)===gara.RADIO){b=this.getSiblingRadioButtons();c=b.indexOf(this);d=c-1;e=c+1;while(b[d]){b[d].handle.tabIndex=-1;d--}while(b[e]){b[e].handle.tabIndex=-1;e++}this.handle.tabIndex=0}this.$super(a)},getImage:function(){return this.image},getSelection:function(){return this.selected},getSiblingRadioButtons:function(){var a,b,c,d,e,f;if(this.parent instanceof gara.widgets.Composite){a=this.parent.getChildren()}else{a=[];b=this.parent.childNodes;for(c=0,len=b.length;c<len;c++){d=b[c];if(d.widget&&d.widget instanceof gara.widgets.Control){a.push(d.widget)}}}e=[this];f=a.indexOf(this);for(c=f-1;c>=0&&a[c]instanceof gara.widgets.Button&&(a[c].getStyle()&gara.RADIO)===gara.RADIO;--c){e.unshift(a[c])}for(c=f+1;c<a.length&&a[c]instanceof gara.widgets.Button&&(a[c].getStyle()&gara.RADIO)===gara.RADIO;++c){e.push(a[c])}return e},getText:function(){return this.text},handleEvent:function(a){this.checkWidget();if(!this.enabled){return}a.widget=this;this.event=a;this.handleMouseEvents(a);if(this.menu!==null&&this.menu.isVisible()){this.menu.handleEvent(a)}else{this.handleKeyEvents(a);this.handleMenu(a)}this.$super(a);a.stopPropagation();return false},handleMouseEvents:function(a){switch(a.type){case"mousedown":this.handle.setAttribute("aria-pressed",true);this.pressEvent=gara.addEventListener(document,"mouseup",this);break;case"mouseup":this.handle.setAttribute("aria-pressed",false);if(this.pressEvent!==null){gara.removeEventListener(document,"mouseup",this);this.pressEvent=null}if(a.target.widget&&a.target.widget===this){this.setSelection((this.style&gara.RADIO)===gara.RADIO?true:!this.getSelection())}break}},handleKeyEvents:function(a){var b,c,d,e;switch(a.type){case"keyup":this.handle.setAttribute("aria-pressed",false);this.preventScrolling(a);break;case"keydown":switch(a.keyCode){case gara.SPACE:this.handle.setAttribute("aria-pressed",true);this.setSelection((this.style&gara.RADIO)===gara.RADIO?true:!this.getSelection());break;case gara.ARROW_DOWN:case gara.ARROW_RIGHT:b=this.getSiblingRadioButtons();c=b.indexOf(this);d=c+1;if(d>=b.length){d=0}while(d<=b.length){if(b[d].getEnabled()){break}d=d<b.length-1?d+1:b.length-1;if(d<=b.length&&!b[d].getEnabled()){d=0}}if(!a.ctrlKey){b[d].setSelection(true)}b[d].forceFocus();break;case gara.ARROW_UP:case gara.ARROW_LEFT:b=this.getSiblingRadioButtons();c=b.indexOf(this);e=c-1;if(e<0){e=b.length-1}while(e>=0){if(b[e].getEnabled()){break}e=e>0?e-1:0;if(e>=0&&!b[e].getEnabled()){e=b.length-1}}if(!a.ctrlKey){b[e].setSelection(true)}b[e].forceFocus();break;case gara.ENTER:this.notifySelectionListener();break}this.preventScrolling(a);break}},notifySelectionListener:function(){this.selectionListeners.forEach(function(a){if(a.widgetSelected){a.widgetSelected(this.event)}},this)},removeSelectionListener:function(a){this.checkWidget();this.selectionListeners.remove(a)},setImage:function(a){this.image=a;if(this.handle){if(this.image!==null){this.img.src=this.image.src;this.img.style.display=""}else{this.img.src="";this.img.style.display="none"}}return this},setSelection:function(a){var b,c,d,e;this.checkWidget();if(((this.style&gara.CHECK)===gara.CHECK||(this.style&gara.RADIO)===gara.RADIO)&&this.enabled){this.selected=a;if(this.handle){this.handle.setAttribute("aria-checked",this.selected)}if((this.style&gara.RADIO)===gara.RADIO&&a){b=this.getSiblingRadioButtons();c=b.indexOf(this);d=c-1;e=c+1;while(b[d]){b[d].setSelection(false);d--}while(b[e]){b[e].setSelection(false);e++}}}this.notifySelectionListener();return this},setText:function(a){this.text=a;this.spanText.nodeValue=this.text;return this},unbindListener:function(a,b){gara.removeEventListener(this.handle,a,b)},update:function(){this.checkWidget()}}});