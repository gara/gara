gara.provide("gara.widgets.Shell","gara.widgets.Decorations");gara.use("gara.widgets.Display");gara.Class("gara.widgets.Shell",function(){return{$extends:gara.widgets.Decorations,alpha:100,shellListeners:null,$constructor:function(a,b){if(!(a instanceof gara.widgets.Shell)&&!(a instanceof gara.widgets.Display)){b=a|gara.SHELL_TRIM;a=gara.widgets.Display.getDefault()}else{b|=gara.DIALOG_TRIM}var d=this;this.enabled=false;this.maximized=false;this.minimized=false;this.fullScreen=false;this.shellListeners=[];this.alpha=100;this.resizeListener={handleEvent:function(){d.adjustWidth(document.documentElement.clientWidth);d.adjustHeight(document.documentElement.clientHeight);d.layout()}};this.$super(a,gara.widgets.Shell.checkStyle(b))},addShellListener:function(a){if(!this.shellListeners.contains(a)){this.shellListeners.add(a)}return this},adjustHeight:function(a){if(this.fullScreen){this.restoreHeight=a;return}this.$super(a)},adjustWidth:function(a){if(this.fullScreen){this.restoreWidth=a;return}this.$super(a)},checkStyle:gara.$static(function(a){a=gara.widgets.Decorations.checkStyle(a);return a}),close:function(){if(this.notifyShellListener("shellClosed")){this.handle.blur();this.setVisible(false);this.getDisplay().setActiveShell(null)}},createWidget:function(){this.$super();this.addClass("garaShell");this.positionOffsetX=0;this.positionOffsetY=0;this.x=this.y=null;this.setVisible(false);if((this.style&gara.TITLE)!==0){this.handle.setAttribute("role","dialog")}gara.addEventListener(document,"keydown",this);if(this.stub){this.handle.parentNode.removeChild(this.stub);delete this.stub;this.stub=null}},destroyWidget:function(){this.shellListeners=[];this.$super()},forceActive:function(){this.handle.setAttribute("data-gara-forceactive",true);this.setActivate()},getAlpha:function(){return this.alpha},getFullScreen:function(){return this.fullScreen},getShell:function(){return this},handleEvent:function(a){var b=true;switch(a.type){case"click":if(a.target===this.titleCloseButton){this.close();b=false}break;case"keydown":if(a.keyCode===gara.ESC&&!a.preventShellClose){this.close();b=false}break}if(b){this.$super(a)}},moveAbove:function(e){var c=this.getDisplay().getShells();c.remove(this);c.insertAt(e&&c.contains(e)?c.indexOf(e):0,this);c.forEach(function(a,b,d){a.handle.style.zIndex=1+(d.length-b)},this)},moveBelow:function(e){var c=this.getDisplay().getShells();c.remove(this);c.insertAt(e&&c.contains(e)?c.indexOf(e)+1:c.length,this);c.forEach(function(a,b,d){a.handle.style.zIndex=1+(d.length-b)},this)},notifyShellListener:function(d){var e=true,c=this.event||window.event||{};c.widget=this;c.control=this;this.shellListeners.forEach(function(a){var b;if(a[d]){b=a[d](c);if(typeof(b)!=="undefined"){e=b}}},this);return e},open:function(){var a=this.parent instanceof gara.widgets.Display?document.documentElement.clientWidth:this.parent.getClientArea().clientWidth,b=this.parent instanceof gara.widgets.Display?document.documentElement.clientHeight:this.parent.getClientArea().clientHeight;this.setVisible(true);this.setFocus();if(this.x===null){this.x=Math.floor(a/2)-this.handle.offsetWidth/2}if(this.y===null){this.y=Math.floor(b/2)-this.handle.offsetHeight/2}this.setLocation(this.x,this.y);this.adjustWidth(this.getWidth());this.adjustHeight(this.getHeight())},removeShellListener:function(a){this.shellListeners.remove(a);return this},setActive:function(){if(this.getMinimized()){return false}var a=this.getDisplay().getActiveShell(),b;if(a===this){return true}if(a!==null&&!a.notifyShellListener("shellDeactivated")){return false}b=this.notifyShellListener("shellActivated");if(this.handle.hasAttribute("data-gara-forceactive")||b){this.getDisplay().setActiveShell(this)}this.handle.removeAttribute("data-gara-forceactive");return b},setAlpha:function(a){this.alpha=a;this.handle.style.opacity=a/100;this.handle.style.filter="alpha(opacity="+a+")";return this},setFullScreen:function(a){var b=document.documentElement,d=this.getParent().getId?this.getParent().getId():this.getParent().id;if(a){if(this.minimized){gara.widgets.Decorations.minis[d][gara.widgets.Decorations.minis[d].indexOf(this)]=undefined}if(this.restoreWidth===null){this.restoreWidth=this.handle.offsetWidth}if(this.restoreHeight===null){this.restoreHeight=this.handle.offsetHeight}if((this.style&gara.TITLE)!==0){this.title.style.display="none"}if((this.style&gara.RESIZE)!==0){this.resizeNNW.style.display="none";this.resizeWNW.style.display="none";this.resizeN.style.display="none";this.resizeNNE.style.display="none";this.resizeENE.style.display="none";this.resizeE.style.display="none";this.resizeW.style.display="none";this.resizeSSW.style.display="none";this.resizeWSW.style.display="none";this.resizeS.style.display="none";this.resizeSSE.style.display="none";this.resizeESE.style.display="none"}this.setClass("garaBorder",false);this.handle.style.left=0;this.handle.style.top=0;this.handle.style.width=b.clientWidth+"px";this.handle.style.height=b.clientHeight+"px";this.clientArea.style.width=b.clientWidth+"px";this.clientArea.style.height=(b.clientHeight-(this.title?this.title.clientHeight:0)-this.menuBarNode.offsetHeight)+"px";gara.addEventListener(window,"resize",this.resizeListener)}this.fullScreen=a;if(!a){if((this.style&gara.TITLE)!==0){this.title.style.display="block"}if((this.style&gara.RESIZE)!==0){this.resizeNNW.style.display="block";this.resizeWNW.style.display="block";this.resizeN.style.display="block";this.resizeNNE.style.display="block";this.resizeENE.style.display="block";this.resizeE.style.display="block";this.resizeW.style.display="block";this.resizeSSW.style.display="block";this.resizeWSW.style.display="block";this.resizeS.style.display="block";this.resizeSSE.style.display="block";this.resizeESE.style.display="block"}this.setClass("garaBorder",(this.style&gara.BORDER)!==0);this.handle.style.left=this.x+"px";this.handle.style.top=this.y+"px";this.adjustWidth(this.restoreWidth);this.adjustHeight(this.restoreHeight);this.restoreWidth=null;this.restoreHeight=null;gara.removeEventListener(window,"resize",this.resizeListener)}this.layout()},setHeight:function(a){if(this.maximized||this.minimized||this.fullScreen){this.height=a}else{this.$super(a)}return this},setLocation:function(a,b){if(this.maximized||this.minimized||this.fullScreen){if(a>0){this.x=a}if(b>0){this.y=b}}else{this.$super(a,b)}return this},setWidth:function(a){if(this.maximized||this.minimized||this.fullScreen){this.width=a}else{this.$super(a)}return this},setMaximized:function(a){if(this.minimized&&!this.notifyShellListener("shellDeiconified")){return this}return this.$super(a)},setMinimized:function(a){if(!a&&!this.notifyShellListener("shellDeiconified")){return this}if(a&&!this.notifyShellListener("shellIconified")){return this}if(a){this.getDisplay().setActiveShell(null)}else{this.getDisplay().setActiveShell(this)}return this.$super(a)}}});