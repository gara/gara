gara.provide("gara.widgets.Decorations","gara.widgets.Composite");gara.use("gara.widgets.Menu");gara.use("gara.widgets.Display");gara.Class("gara.widgets.Decorations",function(){return{$extends:gara.widgets.Composite,image:null,text:"",menuBar:null,stub:null,title:null,titleRight:null,titleTextNode:null,titleImage:null,titleButtons:null,titleCloseButton:null,titleMinButton:null,titleMaxButton:null,minis:gara.$static({}),$constructor:function(d,a){var c=this;this.image=null;this.text="";this.menuBar=null;this.box=null;this.dX=0;this.dY=0;this.offsetX=0;this.offsetY=0;this.overflow=null;this.stub=null;this.title=null;this.titleRight=null;this.titleTextNode=null;this.titleImage=null;this.titleButtons=null;this.titleCloseButton=null;this.titleMinButton=null;this.titleMaxButton=null;this.enabled=false;this.maximized=false;this.minimized=false;this.defaultButton=null;this.resizeNNW=null;this.resizeWNW=null;this.resizeN=null;this.resizeNNE=null;this.resizeENE=null;this.resizeE=null;this.resizeW=null;this.resizeSSW=null;this.resizeWSW=null;this.resizeS=null;this.resizeSSE=null;this.resizeESE=null;this.adjustedHeight=false;this.adjustedWidth=false;this.restoreWidth=null;this.restoreHeight=null;this.menuBarResizeListener={controlResized:function(b){if(c.height>0){c.clientArea.style.height=(c.handle.clientHeight-(c.title?c.title.offsetHeight:0)-c.menuBarNode.offsetHeight)+"px"}}};this.$super(d,gara.widgets.Decorations.checkStyle(a));this.addFocusListener(this)},adjustHeight:function(b){if(this.minimized||this.maximized){this.restoreHeight=b;return}this.$super(b);if(b>1){this.clientArea.style.height=(b-(this.title?this.title.offsetHeight:0)-this.menuBarNode.offsetHeight)+"px"}},adjustWidth:function(b){if(this.minimized||this.maximized){this.restoreWidth=b;return}this.$super(b);if(b>1){this.clientArea.style.width=b+"px"}},bindListener:function(b,d){gara.addEventListener(this.handle,b,d)},destroyWidget:function(){this.resizeNNW=null;this.resizeWNW=null;this.resizeN=null;this.resizeNNE=null;this.resizeENE=null;this.resizeE=null;this.resizeW=null;this.resizeSSW=null;this.resizeWSW=null;this.resizeS=null;this.resizeSSE=null;this.resizeESE=null;this.menuBarNode=null;this.clientArea=null;this.defaultButton=null;if(this.stub!==null){this.handle.parentNode.removeChild(this.stub);this.stub=null}this.$super()},checkStyle:gara.$static(function(b){if((b&gara.NO_TRIM)!==0){b&=~(gara.CLOSE|gara.TITLE|gara.MIN|gara.MAX|gara.RESIZE|gara.BORDER)}if((b&(gara.MIN|gara.MAX|gara.CLOSE))!==0){b|=gara.TITLE}return b}),createWidget:function(){this.createHandle("div");this.handle.setAttribute("role","group");this.addClass("garaDecorations");this.setClass("garaBorder",(this.style&gara.BORDER)!==0);this.moveParent=this.getParent()instanceof gara.widgets.Widget?this.getParent().handle:(this.getParent()instanceof gara.widgets.Display?this.getParent().getClientArea():this.getParent());if((this.style&gara.TITLE)!==0){this.title=document.createElement("div");this.title.className="garaDecorationsTitle";this.title.widget=this;this.titleRight=document.createElement("div");this.titleRight.className="garaDecorationsTitleRight";this.titleRight.widget=this;this.title.appendChild(this.titleRight);if((this.style&(gara.MIN|gara.MAX|gara.CLOSE))!==0){this.titleButtons=document.createElement("div");this.titleButtons.className="garaDecorationsTitleButtons";this.titleButtons.widget=this;this.titleCloseButton=document.createElement("span");this.titleCloseButton.className="garaDecorationsCloseButton"+(((this.style&gara.CLOSE)!==0)?" garaDecorationsCloseButtonActive":" garaDecorationsCloseButtonDeactive");this.titleButtons.appendChild(this.titleCloseButton);this.title.appendChild(this.titleButtons);if((this.style&(gara.MIN|gara.MAX))!==0){this.titleMinButton=document.createElement("span");this.titleMinButton.className="garaDecorationsMinButton"+(((this.style&gara.MIN)!==0)?" garaDecorationsMinButtonActive":" garaDecorationsMinButtonDeactive");this.titleMinButton.widget=this;this.titleButtons.appendChild(this.titleMinButton);this.titleMaxButton=document.createElement("span");this.titleMaxButton.className="garaDecorationsMaxButton"+(((this.style&gara.MAX)!==0)?" garaDecorationsMaxButtonActive":" garaDecorationsMaxButtonDeactive");this.titleMaxButton.widget=this;this.titleButtons.appendChild(this.titleMaxButton)}gara.addEventListener(this.titleButtons,"click",this)}this.titleTextNode=document.createElement("div");this.titleTextNode.className="garaDecorationsTitleText";this.titleTextNode.id=this.getId()+"-label";this.titleTextNode.widget=this;this.titleImage=document.createElement("img");this.titleImage.widget=this;this.titleText=document.createTextNode(this.text);if(this.image){this.titleImage.src=this.image.src}else{this.titleImage.style.display="none"}this.titleTextNode.appendChild(this.titleImage);this.titleTextNode.appendChild(this.titleText);this.title.appendChild(this.titleTextNode);this.handle.appendChild(this.title);this.handle.setAttribute("aria-labelledby",this.getId()+"-label")}if((this.style&gara.RESIZE)!==0){this.resizeNNW=document.createElement("div");this.resizeWNW=document.createElement("div");this.resizeN=document.createElement("div");this.resizeNNE=document.createElement("div");this.resizeENE=document.createElement("div");this.resizeE=document.createElement("div");this.resizeW=document.createElement("div");this.resizeSSW=document.createElement("div");this.resizeWSW=document.createElement("div");this.resizeS=document.createElement("div");this.resizeSSE=document.createElement("div");this.resizeESE=document.createElement("div");this.resizeNNW.className="garaResize garaResizeNNW";this.resizeWNW.className="garaResize garaResizeWNW";this.resizeN.className="garaResize garaResizeN";this.resizeNNE.className="garaResize garaResizeNNE";this.resizeENE.className="garaResize garaResizeENE";this.resizeE.className="garaResize garaResizeE";this.resizeW.className="garaResize garaResizeW";this.resizeSSW.className="garaResize garaResizeSSW";this.resizeWSW.className="garaResize garaResizeWSW";this.resizeS.className="garaResize garaResizeS";this.resizeSSE.className="garaResize garaResizeSSE";this.resizeESE.className="garaResize garaResizeESE";this.handle.appendChild(this.resizeNNW);this.handle.appendChild(this.resizeWNW);this.handle.appendChild(this.resizeN);this.handle.appendChild(this.resizeNNE);this.handle.appendChild(this.resizeENE);this.handle.appendChild(this.resizeE);this.handle.appendChild(this.resizeW);this.handle.appendChild(this.resizeSSW);this.handle.appendChild(this.resizeWSW);this.handle.appendChild(this.resizeS);this.handle.appendChild(this.resizeSSE);this.handle.appendChild(this.resizeESE)}this.menuBarNode=document.createElement("div");this.menuBarNode.className="garaDecorationsMenuBar";this.menuBarNode.style.display="none";this.handle.appendChild(this.menuBarNode);this.clientArea=document.createElement("div");this.clientArea.className="garaClientArea garaDecorationsClientArea";this.handle.appendChild(this.clientArea);this.addListener("mousedown",this);if((this.style&gara.RESIZE)!==0||(this.style&gara.TITLE)!==0){this.stub=document.createElement("div");this.stub.className="garaStub";this.stub.style.display="none";this.handle.parentNode.insertBefore(this.stub,this.handle)}},focusGained:function(b){if(this.defaultButton!==null){this.defaultButton.setFocus()}},getDefaultButton:function(){return this.defaultButton},getImage:function(){return this.image},getMaximized:function(){return this.maximized},getMenuBar:function(){return this.menuBar},getMinimized:function(){return this.minimized},getText:function(){return this.text},handleEvent:function(a){var c,e=function(b){var d=currentTop=0;if(b.offsetParent){do{d+=b.offsetLeft;currentTop+=b.offsetTop}while(b=b.offsetParent)}return[d,currentTop]},f,g,h,i;a.widget=this;this.event=a;switch(a.type){case"click":switch(a.target){case this.titleCloseButton:this.setVisible(false);break;case this.titleMinButton:this.setMinimized(!this.minimized);a.stopPropagation();break;case this.titleMaxButton:this.setMaximized(!this.maximized);break}break;case"mousedown":if((a.target===this.title||a.target===this.titleRight||a.target===this.titleButtons||a.target===this.titleTextNode)&&!this.maximized&&!this.minimized){this.makeAbsolute();gara.addEventListener(this.moveParent,"mousemove",this);gara.addEventListener(this.title,"mouseup",this);this.doX=a.clientX-this.handle.offsetLeft;this.doY=a.clientY-this.handle.offsetTop;this.overflow=this.moveParent.style.overflow;this.moveParent.style.overflow="hidden";c=e(this.moveParent);this.offsetX=c[0];this.offsetY=c[1];this.moving=true}if((a.target===this.resizeNNW||a.target===this.resizeWNW||a.target===this.resizeNNE||a.target===this.resizeENE||a.target===this.resizeN||a.target===this.resizeS)||a.target===this.resizeW||a.target===this.resizeE||a.target===this.resizeSSW||a.target===this.resizeWSW||a.target===this.resizeSSE||a.target===this.resizeESE&&!this.maximized&&!this.minimized){this.makeAbsolute();gara.addEventListener(this.moveParent,"mousemove",this);gara.addEventListener(gara.widgets.Display.getDefault().getClientArea(),"mouseup",this);this.dX=a.clientX;this.dY=a.clientY;this.doX=a.clientX-this.handle.offsetLeft;this.doY=a.clientY-this.handle.offsetTop;c=e(this.moveParent);this.offsetX=c[0];this.offsetY=c[1];this.offsetTop=this.handle.offsetTop;this.offsetLeft=this.handle.offsetLeft;this.offsetWidth=this.handle.offsetWidth;this.offsetHeight=this.handle.offsetHeight;this.minHeight=this.title?this.title.offsetHeight:1;this.minWidth=1+(this.titleRight?this.titleRight.offsetWidth*2:0)+(this.titleButtons?this.titleButtons.offsetWidth:0);this.resizing=true;switch(a.target){case this.resizeNNW:case this.resizeWNW:this.resizeMethod="NW";break;case this.resizeN:this.resizeMethod="N";break;case this.resizeNNE:case this.resizeENE:this.resizeMethod="NE";break;case this.resizeW:this.resizeMethod="W";break;case this.resizeE:this.resizeMethod="E";break;case this.resizeSSW:case this.resizeWSW:this.resizeMethod="SW";break;case this.resizeS:this.resizeMethod="S";break;case this.resizeSSE:case this.resizeESE:this.resizeMethod="SE";break}}break;case"mousemove":if(this.moving){if(a.clientX>this.offsetX&&a.clientY>this.offsetY&&a.clientX<(this.offsetX+this.moveParent.clientWidth)&&a.clientY<(this.offsetY+this.moveParent.clientHeight)){this.x=a.clientX-this.doX;this.y=a.clientY-this.doY;if(this.handle!==null){this.handle.style.left=(this.x-this.positionOffsetX)+"px";this.handle.style.top=(this.y-this.positionOffsetY)+"px"}}}if(this.resizing){if(a.clientX>this.offsetX&&a.clientY>this.offsetY&&a.clientX<(this.offsetX+this.moveParent.clientWidth)&&a.clientY<(this.offsetY+this.moveParent.clientHeight)){f=function(){if(this.offsetHeight+(this.offsetTop-(a.clientY-this.doY))>this.minHeight){this.handle.style.top=(a.clientY-this.doY)+"px";this.setHeight(this.offsetHeight+(this.offsetTop-(a.clientY-this.doY)))}};i=function(){if(this.offsetWidth+(this.offsetLeft-(a.clientX-this.doX))>this.minWidth){this.handle.style.left=(a.clientX-this.doX)+"px";this.setWidth(this.offsetWidth+(this.offsetLeft-(a.clientX-this.doX)))}};g=function(){if((this.offsetWidth+a.clientX-this.dX)>this.minWidth){this.setWidth(this.offsetWidth+a.clientX-this.dX)}};h=function(){if((this.offsetHeight+a.clientY-this.dY)>this.minHeight){this.setHeight(this.offsetHeight+a.clientY-this.dY)}};switch(this.resizeMethod){case"NW":i.call(this);f.call(this);break;case"N":f.call(this);break;case"NE":f.call(this);g.call(this);break;case"E":g.call(this);break;case"SE":g.call(this);h.call(this);break;case"S":h.call(this);break;case"SW":h.call(this);i.call(this);break;case"W":i.call(this);break}this.layout()}}break;case"mouseup":if(this.moving){this.moveParent.style.overflow=this.overflow;gara.removeEventListener(this.moveParent,"mousemove",this);gara.removeEventListener(this.title,"mouseup",this);this.moving=false}if(this.resizing){gara.removeEventListener(this.moveParent,"mousemove",this);gara.removeEventListener(gara.widgets.Display.getDefault().getClientArea(),"mouseup",this);this.resizing=false}break}},makeAbsolute:function(){if(this.handle.style.position!=="absolute"){this.positionOffsetX=this.positionOffsetY=0;this.setLocation(this.handle.offsetLeft-1,this.handle.offsetTop-1);this.handle.style.position="absolute";if(this.stub!==null){this.stub.style.display="block"}}},menuShell:function(){return this},releaseChildren:function(){if(this.menu!==null){this.menu.release();this.menu=null}this.$super()},scrolledHandle:function(){return this.clientArea},setDefaultButton:function(b){this.checkWidget();if(!(b instanceof gara.widgets.Button)){throw new TypeError("button not instanceof gara.widgets.Button");}if(b!==null&&(b.isDisposed()||b.menuShell()!==this||(b.getStyle()&gara.PUSH)===0||b===this.defaultButton)){return}if(this.defaultButton!==null){this.defaultButton.removeClass("garaButtonDefault")}this.defaultButton=b;this.defaultButton.addClass("garaButtonDefault")},setHeight:function(b){this.$super(b);if(!this.adjustedHeight&&b!==null&&this.stub!==null){this.stub.style.height=b+"px";this.adjustedHeight=true}return this},setImage:function(b){this.image=b;if(this.titleImage){if(this.image){this.titleImage.src=this.image.src;this.titleImage.style.display="inline"}else{this.titleImage.style.display="none"}}return this},setMaximized:function(b){var d=this.getParent().getClientArea?this.getParent().getClientArea():this.getParent(),a=this.getParent().getId?this.getParent().getId():this.getParent().id,c,e;if(b){if(this.minimized){gara.widgets.Decorations.minis[a][gara.widgets.Decorations.minis[a].indexOf(this)]=undefined}if(this.restoreWidth===null){this.restoreWidth=this.handle.offsetWidth}if(this.restoreHeight===null){this.restoreHeight=this.handle.offsetHeight}if(d===gara.widgets.Display.getDefault().getClientArea()){d=document.documentElement}this.makeAbsolute();this.handle.style.left=0;this.handle.style.top=0;this.handle.style.width=d.clientWidth+"px";this.handle.style.height=d.clientHeight+"px";this.clientArea.style.width=d.clientWidth+"px";this.clientArea.style.height=(d.clientHeight-(this.title?this.title.clientHeight:0)-this.menuBarNode.offsetHeight)+"px"}this.maximized=b;this.minimized=false;this.setClass("garaDecorationsMinimized",this.minimized);this.setClass("garaDecorationsMaximized",this.maximized);if(!b){this.handle.style.left=this.x+"px";this.handle.style.top=this.y+"px";this.adjustWidth(this.restoreWidth);this.adjustHeight(this.restoreHeight);this.restoreWidth=null;this.restoreHeight=null}this.layout();return this},setMenuBar:function(b){if(this.menuBar===b){return this}if(this.menuBar!==null){this.menuBar.removeControlListener(this.menuBarResizeListener);this.menuBarNode.removeChild(this.menuBar.handle);this.menuBarNode.style.display="none"}if(b){if(!(b instanceof gara.widgets.Menu)&&!((b.getStyle()&gara.BAR)!==0)){throw new TypeError("menu not instance of gara.widgets.Menu and not of BAR style");}b.setVisible(true);b.addControlListener(this.menuBarResizeListener);this.menuBarNode.appendChild(b.handle);this.menuBarNode.style.display="block"}this.menuBar=b;if(this.height>0){this.clientArea.style.height=(this.handle.clientHeight-(this.title?this.title.offsetHeight:0)-this.menuBarNode.offsetHeight)+"px";this.layout()}return this},setMinimized:function(b){var d=this.getParent().getClientArea?this.getParent().getClientArea():this.getParent(),a=this.getParent().getId?this.getParent().getId():this.getParent().id,c=false,e;this.minimized=b;this.maximized=false;this.setClass("garaDecorationsMinimized",this.minimized);this.setClass("garaDecorationsMaximized",this.maximized);if(b){if(this.restoreWidth===null){this.restoreWidth=this.handle.offsetWidth}if(this.restoreHeight===null){this.restoreHeight=this.handle.offsetHeight}this.makeAbsolute();this.handle.style.top="";this.handle.style.bottom=0;this.handle.style.width="";this.handle.style.height="";if(this.menuBar){this.menuBarNode.style.display="none"}if(!Object.prototype.hasOwnProperty.call(gara.widgets.Decorations.minis,a)){gara.widgets.Decorations.minis[a]=[this];c=0}else{len=gara.widgets.Decorations.minis[a].length;e=len-1;while(e>=0&&gara.widgets.Decorations.minis[a][e]===undefined){gara.widgets.Decorations.minis[a].splice(e,1);e--;len--}for(e=0;e<len;e++){if(gara.widgets.Decorations.minis[a][e]===undefined){c=e;break}}if(c===false){c=len;gara.widgets.Decorations.minis[a][gara.widgets.Decorations.minis[a].length]=this}else{gara.widgets.Decorations.minis[a][c]=this}}this.handle.style.left=((c*190)+10)+"px"}else{if(this.menuBar){this.menuBarNode.style.display="block"}this.handle.style.left=this.x+"px";this.handle.style.top=this.y+"px";this.handle.style.bottom="";this.adjustWidth(this.restoreWidth);this.adjustHeight(this.restoreHeight);this.restoreWidth=null;this.restoreHeight=null;gara.widgets.Decorations.minis[a][gara.widgets.Decorations.minis[a].indexOf(this)]=undefined;this.layout()}return this},setText:function(b){this.text=b;if(this.titleText){this.titleText.nodeValue=b}return this},setWidth:function(b){this.$super(b);if(!this.adjustedWidth&&b!==null&&this.stub!==null){this.stub.style.width=b+"px";this.adjustedWidth=true}return this},unbindListener:function(b,d){gara.removeEventListener(this.handle,b,d)},update:function(){this.clientArea.style.height=(this.handle.clientHeight-(this.title?this.title.offsetHeight:0)-this.menuBarNode.offsetHeight)+"px";this.clientArea.style.width=this.handle.clientWidth+"px"}}});