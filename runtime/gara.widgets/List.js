gara.provide("gara.widgets.List","gara.widgets.Composite");gara.use("gara.widgets.ListItem");gara.Class("gara.widgets.List",function(){return{$extends:gara.widgets.Composite,activeItem:null,items:[],selection:[],selectionListeners:[],shiftItem:null,$constructor:function(a,b){this.items=[];this.activeItem=null;this.shiftItem=null;this.selection=[];this.selectionListeners=[];this.$super(a,b||gara.SINGLE);this.addFocusListener(this)},activateItem:function(a){this.checkWidget();if(!(a instanceof gara.widgets.ListItem)){throw new TypeError("item is not type of gara.widgets.ListItem");}if(this.activeItem!==null&&!this.activeItem.isDisposed()){this.activeItem.setActive(false)}this.activeItem=a;this.activeItem.setActive(true);this.handle.setAttribute("aria-activedescendant",this.activeItem.getId())},addItem:function(a,b){this.checkWidget();if(!(a instanceof gara.widgets.ListItem)){throw new TypeError("item is not type of gara.widgets.ListItem");}if(typeof(b)!=="undefined"){this.items.insertAt(b,a)}else{this.items.push(a)}return this.handle},addSelectionListener:function(a){this.checkWidget();if(!this.selectionListeners.contains(a)){this.selectionListeners.add(a)}return this},bindListener:function(a,b){gara.addEventListener(this.handle,a,b)},createWidget:function(){this.createHandle("ul");this.handle.setAttribute("role","listbox");this.handle.setAttribute("aria-multiselectable",(this.style&gara.MULTI)===gara.MULTI?true:false);this.handle.setAttribute("aria-activedescendant",this.getId());this.addClass("garaList");this.setClass("garaListFullSelection",(this.style&gara.FULL_SELECTION)===gara.FULL_SELECTION);this.setClass("garaListCheckbox",(this.style&gara.CHECK)===gara.CHECK);this.setClass("garaBorder",(this.style&gara.BORDER)!==0);this.addListener("mousedown",this);if((this.style&gara.CHECK)===gara.CHECK){this.addListener("mouseup",this)}},deselect:function(a){var b;this.checkWidget();if(a<0||a>=this.items.length){return}b=this.items[a];if(this.selection.contains(b)){b.setSelected(false);this.selection.remove(b);this.shiftItem=b;this.notifySelectionListener()}},deselectAll:function(){var a;this.checkWidget();if(this.selection.length){while(this.selection.length){a=this.selection.pop();a.setSelected(false)}this.notifySelectionListener()}},deselectArray:function(b){if(this.selection.length){b.forEach(function(a){if(a<0||a>=this.items.length){return}this.items[a].setSelected(false)},this);this.notifySelectionListener()}},deselectRange:function(a,b){for(var c=a;c<=b;c++){this.items[c].setSelected(false)}this.notifySelectionListener()},destroyWidget:function(){this.items=null;this.activeItem=null;this.shiftItem=null;this.selection=null;this.selectionListeners=null;this.$super()},destroyItem:function(a){if(this.items.contains(a)){this.items.remove(a);this.handle.removeChild(a.handle)}},focusGained:function(a){if(this.activeItem===null&&this.items.length){this.activateItem(this.items[0])}},getItem:function(a){this.checkWidget();if(typeof(this.items.indexOf(a))=="undefined"){throw new RangeError("There is no item for the given index");}return this.items[a]},getItemCount:function(){return this.items.length},getItemHeight:function(a){return a.handle.offsetHeight+gara.getNumStyle(a.handle,"margin-top")+gara.getNumStyle(a.handle,"margin-bottom")},getItems:function(){this.checkWidget();return this.items},getSelection:function(){this.checkWidget();return this.selection},getSelectionCount:function(){this.checkWidget();return this.selection.length},getTopItem:function(){var a,b,c;if(!this.items.length){return null}a=this.scrolledHandle().scrollTop;b=0;for(c=0;c<this.items.length;c++){b+=this.getItemHeight(this.items[c]);if(b>a){return this.items[c]}}},handleEvent:function(a){var b;this.checkWidget();b=a.target.widget||null;a.item=b&&b instanceof gara.widgets.ListItem?b:this.activeItem;a.widget=this;this.event=a;this.handleMouseEvents(a);if(this.menu!==null&&this.menu.isVisible()){this.menu.handleEvent(a)}else{this.handleKeyEvents(a);this.handleMenu(a)}this.$super(a);if(a.item!==null){a.item.handleEvent(a)}if(a.type==="contextmenu"){a.preventDefault()}a.stopPropagation();return false},handleMouseEvents:function(a){var b=a.item;switch(a.type){case"mousedown":if(b!==null){this.activateItem(b);if(!a.ctrlKey&&!a.shiftKey){this.selectAdd(b,false)}else if(a.ctrlKey&&a.shiftKey){this.selectShift(b,true)}else if(a.shiftKey){this.selectShift(b,false)}else if(a.ctrlKey){if(this.selection.contains(b)){this.deselect(this.indexOf(b))}else{this.select(this.indexOf(b),true)}}else{this.select(this.indexOf(b))}}break}},handleKeyEvents:function(a){switch(a.type){case"keyup":case"keydown":case"keypress":if(a.type==="keydown"){this.handleKeyNavigation(a)}this.preventScrolling(a);break}},handleKeyNavigation:function(a){var b,c,d,e,f,g,k,i,h,j;switch(a.keyCode){case gara.ARROW_LEFT:case gara.ARROW_UP:b=false;d=this.indexOf(this.activeItem);if(d!==0){b=this.items[d-1]}if(b){f=0;for(e=0;e<(d-1);e++){f+=this.getItemHeight(this.items[e])}g=this.handle.clientHeight+this.handle.scrollTop-gara.getNumStyle(this.handle,"padding-top")-gara.getNumStyle(this.handle,"padding-bottom");k=b.handle.clientHeight-gara.getNumStyle(b.handle,"padding-top")-gara.getNumStyle(b.handle,"padding-bottom");this.handle.scrollTop=f<this.handle.scrollTop?f:(g<f?f-g+k:this.handle.scrollTop);if(!a.ctrlKey&&!a.shiftKey){this.activateItem(b);this.selectAdd(b,false)}else if(a.ctrlKey&&a.shiftKey){this.activateItem(b);this.selectShift(b,true)}else if(a.shiftKey){this.activateItem(b);this.selectShift(b,false)}else if(a.ctrlKey){this.activateItem(b)}}break;case gara.ARROW_RIGHT:case gara.ARROW_DOWN:c=false;d=this.indexOf(this.activeItem);if(d!==this.items.length-1){c=this.items[d+1]}if(c){f=0;for(e=0;e<=(d+1);e++){f+=this.getItemHeight(this.items[e])}i=f-this.getItemHeight(c);g=this.handle.clientHeight+this.handle.scrollTop-gara.getNumStyle(this.handle,"padding-top")-gara.getNumStyle(this.handle,"padding-bottom");j=f-this.handle.clientHeight+gara.getNumStyle(this.handle,"padding-top")+gara.getNumStyle(this.handle,"padding-bottom");this.handle.scrollTop=f>g?(j<0?0:j):(this.handle.scrollTop>i?i:this.handle.scrollTop);if(!a.ctrlKey&&!a.shiftKey){this.activateItem(c);this.selectAdd(c,false)}else if(a.ctrlKey&&a.shiftKey){this.activateItem(c);this.selectShift(c,true)}else if(a.shiftKey){this.activateItem(c);this.selectShift(c,false)}else if(a.ctrlKey){this.activateItem(c)}}break;case gara.SPACE:if((this.style&gara.CHECK)===gara.CHECK){this.activeItem.setChecked(!this.activeItem.getChecked())}if(this.selection.contains(this.activeItem)&&a.ctrlKey){this.deselect(this.indexOf(this.activeItem))}else{this.selectAdd(this.activeItem,true)}break;case gara.HOME:this.handle.scrollTop=0;if(!a.ctrlKey&&!a.shiftKey){this.activateItem(this.items[0]);this.selectAdd(this.items[0],false)}else if(a.shiftKey){this.activateItem(this.items[0]);this.selectShift(this.items[0],false)}else if(a.ctrlKey){this.activateItem(this.items[0])}break;case gara.END:this.handle.scrollTop=this.handle.scrollHeight-this.handle.clientHeight;h=this.items.length-1;if(!a.ctrlKey&&!a.shiftKey){this.activateItem(this.items[h]);this.selectAdd(this.items[h],false)}else if(a.shiftKey){this.activateItem(this.items[h]);this.selectShift(this.items[h],false)}else if(a.ctrlKey){this.activateItem(this.items[h])}break;case 65:if(a.ctrlKey){this.selectAll()}break}},indexOf:function(a){this.checkWidget();if(!(a instanceof gara.widgets.ListItem)){throw new TypeError("item not instance of gara.widgets.ListItem");}return this.items.indexOf(a)},notifySelectionListener:function(){this.selectionListeners.forEach(function(a){if(a.widgetSelected){a.widgetSelected(this.event)}},this)},releaseChildren:function(){this.items.forEach(function(a){a.release()},this);this.$super()},releaseItem:function(a){if(this.items.contains(a)){this.handle.removeChild(a.handle);this.items.remove(a);this.selection.remove(a)}},remove:function(a){var b;this.checkWidget();if(a<0||a>this.items.length){throw new RangeError("index out of bounds");}b=this.items.removeAt(a)[0];this.selection.remove(b);b.dispose();delete b},removeRange:function(a,b){var c;this.checkWidget();for(c=a;c<=b;++c){this.remove(a)}},removeFromArray:function(d){this.checkWidget();d.forEach(function(a,b,c){this.remove(b)},this)},removeAll:function(){this.checkWidget();while(this.items.length){this.remove(0)}},removeSelectionListener:function(a){this.checkWidget();this.selectionListeners.remove(a);return this},select:function(a){var b;this.checkWidget();if(a<0||a>=this.items.length){return}b=this.items[a];if(!this.selection.contains(b)){b.setSelected(true);this.selection.push(b);this.shiftItem=b;this.notifySelectionListener()}},selectAdd:function(a,b){var c;this.checkWidget();if(!(a instanceof gara.widgets.ListItem)){throw new TypeError("item not instance of gara.widgets.ListItem");}if(!b||(this.style&gara.MULTI)!==gara.MULTI){while(this.selection.length){c=this.selection.pop();c.setSelected(false)}}this.select(this.indexOf(a))},selectAll:function(){this.checkWidget();if((this.style&gara.MULTI)===gara.MULTI){this.items.forEach(function(a){if(!this.selection.contains(a)){a.setSelected(true);this.selection.push(a)}},this);this.notifySelectionListener()}},selectArray:function(b){if(!b.length){return}if(b.length>1&&(this.style&gara.MULTI)===gara.MULTI){b.forEach(function(a){if(!this.selection.contains(this.items[a])){this.items[a].setSelected(true);this.selection.push(this.items[a])}},this);this.notifySelectionListener()}else{this.select(b[b.length-1])}},selectRange:function(a,b){var c;if((b-a)>1&&(this.style&gara.MULTI)===gara.MULTI){for(c=a;c<=b;c++){if(!this.selection.contains(this.items[c])){this.items[c].setSelected(true);this.selection.push(this.items[c])}}this.notifySelectionListener()}else{this.select(b)}},selectShift:function(a,b){var c,d,e,f,g;this.checkWidget();if(!(a instanceof gara.widgets.ListItem)){throw new TypeError("item not instance of gara.widgets.ListItem");}if(!b){while(this.selection.length){this.selection.pop().setSelected(false)}}if((this.style&gara.MULTI)===gara.MULTI){c=this.indexOf(this.shiftItem);d=this.indexOf(a);e=c>d?d:c;f=c<d?d:c;for(g=e;g<=f;++g){this.selection.push(this.items[g]);this.items[g].setSelected(true)}this.notifySelectionListener()}else{this.select(this.indexOf(a))}},setSelection:function(b){var c;this.checkWidget();while(this.selection.length){c=this.selection.pop();if(!c.isDisposed()){c.setSelected(false)}}if(b instanceof Array){if(b.length>1&&(this.style&gara.MULTI)===gara.MULTI){b.forEach(function(a){if(!this.selection.contains(a)){a.setSelected(true);this.selection.push(a)}},this);this.notifySelectionListener()}else if(b.length){this.select(this.items.indexOf(b[b.length-1]))}}else if(gara.instanceOf(b,gara.widgets.ListItem)){this.select(this.indexOf(b))}return this},setTopItem:function(a){var b,c,d;if(!(a instanceof gara.widgets.ListItem)){throw new TypeError("item not instance of gara.widgets.ListItem");}b=this.indexOf(a);c=0;for(d=0;d<b;d++){c+=this.getItemHeight(this.items[b])}this.scrolledHandle().scrollTop=c;return this},showItem:function(a){var b,c,d,e;if(!(a instanceof gara.widgets.ListItem)){throw new TypeError("item not instance of gara.widgets.ListItem");}if(this.getVerticalScrollbar()){b=this.indexOf(a);c=0;for(d=0;d<=b;d++){c+=this.getItemHeight(this.items[d])}if((this.scrolledHandle().scrollTop+this.scrolledHandle().clientHeight)<c||this.scrolledHandle().scrollTop>c){e=c-Math.round(this.getItemHeight(this.items[b])/2)-Math.round(this.scrolledHandle().clientHeight/2);this.scrolledHandle().scrollTop=e}}},showSelection:function(){if(this.selection.length){this.showItem(this.selection[0])}},unbindListener:function(a,b){gara.removeEventListener(this.handle,a,b)},update:function(){this.checkWidget()}}});