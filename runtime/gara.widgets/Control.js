gara.provide("gara.widgets.Control","gara.widgets.Widget");gara.use("gara.widgets.Item");gara.use("gara.widgets.Composite");gara.use("gara.widgets.Menu");gara.use("gara.widgets.Display");gara.Class("gara.widgets.Control",function(){return{$extends:gara.widgets.Widget,hasFocus:false,menu:null,enabled:true,visible:true,x:null,y:null,mouseX:0,mouseY:0,width:0,height:0,$constructor:function(a,b){this.$super(a,b);this.addClass("garaControl");this.controlListeners=[];this.focusListeners=[];this.keyListeners=[];this.mouseListeners=[];this.mouseMoveListeners=[];this.mouseTrackListeners=[];this.mouseWheelListeners=[];this.width=null;this.height=null;this.hasFocus=false;this.menu=null;this.enabled=true;this.visible=true;this.hovering=false;this.mouseX=0;this.mouseY=0;this.x=null;this.y=null;this.positionOffsetX=null;this.positionOffsetY=null;if(this.parent!==null&&this.parent instanceof gara.widgets.Composite){this.parentNode=this.parent.getClientArea()}else if((this.parent!==null&&this.parent instanceof gara.widgets.Display)||this.parent===null){this.parentNode=this.parent.getClientArea()}else{this.parentNode=this.parent}this.shell=a.getShell?a.getShell():null;this.createWidget();this.display.addWidget(this)},addControlListener:function(a){this.checkWidget();if(!this.controlListeners.contains(a)){this.controlListeners.add(a)}return this},addFocusListener:function(a){this.checkWidget();if(!this.focusListeners.contains(a)){this.focusListeners.add(a)}return this},addKeyListener:function(a){this.checkWidget();if(!this.keyListeners.contains(a)){this.keyListeners.add(a)}return this},addMouseListener:(function(){var b=false;return function(a){this.checkWidget();if(!this.mouseListeners.contains(a)){this.mouseListeners.add(a)}if(!b){this.addListener("mousedown",this);this.addListener("mouseup",this);this.addListener("dblclick",this);b=true}return this}})(),addMouseMoveListener:(function(){var b=false;return function(a){this.checkWidget();if(!this.mouseMoveListeners.contains(a)){this.mouseMoveListeners.add(a)}if(!b){this.addListener("mousemove",this);b=true}return this}})(),addMouseTrackListener:(function(){var b=false;return function(a){this.checkWidget();if(!this.mouseTrackListeners.contains(a)){this.mouseTrackListeners.add(a)}if(!b){this.addListener("mouseover",this);this.addListener("mouseout",this);b=true}return this}})(),addMouseWheelListener:(function(){var b=false;return function(a){this.checkWidget();if(!this.mouseWheelListeners.contains(a)){this.mouseWheelListeners.add(a)}if(!b){this.addListener("mousewheel",this);b=true}return this}})(),adjustHeight:function(a){if(a>1){this.handle.style.height=parseInt(a)+"px"}else if(a===null){this.handle.style.height="auto"}else if(a>=0&&a<=1){this.handle.style.height=a*100+"%"}},adjustWidth:function(a){if(a>1){this.handle.style.width=parseInt(a)+"px"}else if(a===null){this.handle.style.width="auto"}else if(a>=0&&a<=1){this.handle.style.width=a*100+"%"}},createWidget:function(){},createHandle:function(d,c){var g;this.handle=document.createElement(d);this.handle.id=this.getId();this.handle.widget=this;this.handle.control=this;this.handle.tabIndex=this.enabled?0:-1;this.handle.className=this.classes.join(" ");for(g in this.listeners){this.listeners[g].forEach(function(a,b,f){this.bindListener(g,a)},this)}if(!c){this.addHandleToDOM()}},addHandleToDOM:function(){if(this.parentNode!==null){this.parentNode.appendChild(this.handle);this.x=this.handle.offsetLeft;this.y=this.handle.offsetTop;this.positionOffsetX=this.handle.offsetLeft;this.positionOffsetY=this.handle.offsetTop}},destroyWidget:function(){this.display.removeWidget(this);if(this.parentNode!==null){try{this.parentNode.removeChild(this.handle)}catch(e){}}this.controlListeners=[];this.focusListeners=[];this.keyListeners=[];this.mouseListeners=[];this.mouseMoveListeners=[];this.mouseTrackListeners=[];this.mouseWheelListeners=[];this.shell=null;this.parentNode=null;this.$super()},forceFocus:function(){this.handle.setAttribute("data-gara-forcefocus",true);this.handle.focus()},getEnabled:function(){return this.enabled},getHeight:function(){return this.height},getLocation:function(){return{x:this.x,y:this.y}},getShell:function(){return this.shell},getWidth:function(){return this.width},getVisible:function(){return this.visible},handleEvent:function(b){if(this.isDisposed()){return}switch(b.type){case"keydown":this.keyListeners.forEach(function(a){if(a.keyPressed){a.keyPressed(b)}},this);break;case"keyup":this.keyListeners.forEach(function(a){if(a.keyReleased){a.keyReleased(b)}},this);break;case"dblclick":this.mouseListeners.forEach(function(a){if(a.mouseDoubleClick){a.mouseDoubleClick(b)}},this);break;case"mousedown":this.mouseListeners.forEach(function(a){if(a.mouseDown){a.mouseDown(b)}},this);break;case"mouseup":this.mouseListeners.forEach(function(a){if(a.mouseUp){a.mouseUp(b)}},this);break;case"mousemove":this.mouseX=(b.pageX||b.clientX+document.documentElement.scrollLeft)+1;this.mouseY=(b.pageY||b.clientY+document.documentElement.scrollTop)+1;this.mouseMoveListeners.forEach(function(a){if(a.mouseMove){a.mouseMove(b)}},this);break;case"mouseover":if(b.target.widget===this||(b.target.widget instanceof gara.widgets.Item&&b.target.control===this)){if(!this.hovering){this.mouseTrackListeners.forEach(function(a){if(a.mouseEnter){a.mouseEnter(b)}},this);this.hovering=true}this.mouseTrackListeners.forEach(function(a){if(a.mouseHover){a.mouseHover(b)}},this)}break;case"mouseout":if(!b.relatedTarget||typeof b.relatedTarget.widget==="undefined"||(b.relatedTarget.widget!==this&&b.relatedTarget.widget instanceof gara.widgets.Item&&b.relatedTarget.control!==this)){this.mouseTrackListeners.forEach(function(a){if(a.mouseExit){a.mouseExit(b)}},this);this.hovering=false}break;case"mousewheel":this.mouseWheelListeners.forEach(function(a){if(a.mouseScrolled){a.mouseScrolled(b)}},this);break}},handleMenu:function(a){switch(a.type){case"keydown":if(this.menu!==null&&a.shiftKey&&a.keyCode===gara.F10){this.menu.update();this.menu.setLocation(this.mouseX,this.mouseY);this.menu.setVisible(true,a);a.preventDefault()}break;case"contextmenu":if(this.menu!==null){this.menu.update();this.menu.setLocation(this.mouseX,this.mouseY);this.menu.setVisible(true,a);a.preventDefault()}break;case"mousedown":if(window.opera&&(a.altKey||a.ctrlKey)&&this.menu!==null){this.menu.update();this.menu.setLocation(this.mouseX,this.mouseY);this.menu.setVisible(true,a)}break}},isFocusControl:function(){return this.display.getFocusControl()===this},menuShell:function(){if(this.parent.menuShell){return this.parent.menuShell()}return null},moveAbove:function(d){var c;if(this.getParent().getChildren){c=this.getParent().getChildren();c.remove(this);c.insertAt(d&&c.contains(d)?c.indexOf(d):0,this);c.forEach(function(a,b,f){a.handle.style.zIndex=1+(f.length-b)},this)}},moveBelow:function(d){var c;if(this.getParent().getChildren){c=this.getParent().getChildren();c.remove(this);c.insertAt(d&&c.contains(d)?c.indexOf(d)+1:c.length,this);c.forEach(function(a,b,f){a.handle.style.zIndex=1+(f.length-b)},this)}},notifyFocusListener:function(f){var d=true,c=this.event||window.event||{};c.widget=this;c.control=this;this.focusListeners.forEach(function(a){var b;if(a[f]){b=a[f](c);if(typeof(b)!=="undefined"){d=b}}},this);return d},notifyResizeListener:function(){var f=true,d=this.event||window.event||{};d.widget=this;d.control=this;this.controlListeners.forEach(function(a){var b;if(a.controlResized){b=a.controlResized(d);if(typeof(b)!=="undefined"){f=b}}},this);return f},preventScrolling:function(a){if(a.keyCode===gara.ARROW_UP||a.keyCode===gara.ARROW_DOWN||a.keyCode===gara.ARROW_LEFT||a.keyCode===gara.ARROW_RIGHT||a.keyCode===gara.PAGE_UP||a.keyCode===gara.PAGE_DOWN||a.keyCode===gara.HOME||a.keyCode===gara.END||a.keyCode===gara.SPACE){a.preventDefault()}},removeControlListener:function(a){this.checkWidget();this.controlListeners.remove(a);return this},removeFocusListener:function(a){this.checkWidget();this.focusListeners.remove(a);return this},removeKeyListener:function(a){this.checkWidget();this.keyListeners.remove(a);return this},removeMouseListener:function(a){this.checkWidget();this.mouseListeners.remove(a);return this},removeMouseMoveListener:function(a){this.checkWidget();this.mouseMoveListeners.remove(a);return this},removeMouseTrackListener:function(a){this.checkWidget();this.mouseTrackListeners.remove(a);return this},removeMouseWheelListener:function(a){this.checkWidget();this.mouseWheelListeners.remove(a);return this},setEnabled:function(a){this.enabled=a;this.handle.setAttribute("aria-disabled",!this.enabled);this.handle.tabIndex=this.enabled?0:-1;return this},setFocus:function(){this.handle.focus()},setHeight:function(b){this.height=b;this.adjustHeight(b);if(b===null&&this.parent instanceof gara.widgets.Composite){this.parent.layout()}this.controlListeners.forEach(function(a){if(a.controlResized){a.controlResized({widget:this})}},this);return this},setLocation:function(b,f){if(b>=0){this.x=b;this.handle.style.left=(b-this.positionOffsetX)+"px"}if(f>=0){this.y=f;this.handle.style.top=(f-this.positionOffsetY)+"px"}this.controlListeners.forEach(function(a){if(a.controlMoved){a.controlMoved({widget:this})}},this);return this},setMenu:function(a){if(a!==null&&!(a instanceof gara.widgets.Menu)){throw new TypeError("menu is not a gara.widgets.Menu");}if(this.menu&&a===null){this.removeListener("contextmenu",this);this.removeListener("mousedown",this);gara.removeEventListener(document,"mousemove",this);this.handle.setAttribute("aria-haspopup",false);this.handle.removeAttribute("aria-owns")}else{this.addListener("contextmenu",this);this.addListener("mousedown",this);gara.addEventListener(document,"mousemove",this);this.handle.setAttribute("aria-haspopup",true);this.handle.setAttribute("aria-owns",a.getId())}this.menu=a;return this},setSize:function(){if(arguments.length==2){this.setWidth(arguments[0]);this.setHeight(arguments[1])}else{this.setWidth(arguments[0].x);this.setHeight(arguments[0].y)}},setVisible:function(a){this.visible=a;this.handle.style.display=a?"block":"none"},setWidth:function(b){this.width=b;this.adjustWidth(b);if(b===null&&this.parent instanceof gara.widgets.Composite){this.parent.layout()}this.controlListeners.forEach(function(a){if(a.controlResized){a.controlResized({widget:this})}},this);return this},topHandle:function(){return this.handle},update:function(){}}});