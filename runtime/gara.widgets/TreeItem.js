gara.provide("gara.widgets.TreeItem","gara.widgets.Item");gara.require("gara.widgets.Tree");gara.Class("gara.widgets.TreeItem",function(){return{$extends:gara.widgets.Item,checkbox:null,checked:false,childContainer:null,expanded:true,grayed:false,images:[],img:null,items:[],selected:false,span:null,spanText:null,texts:[],toggleNode:null,tree:null,$constructor:function(a,b,c){if(!(a instanceof gara.widgets.Tree||a instanceof gara.widgets.TreeItem)){throw new TypeError("parent is neither a gara.widgets.Tree nor gara.widgets.TreeItem");}this.$super(a,b);this.parent=a;this.items=[];this.texts=[];this.images=[];this.selected=false;this.checked=false;this.grayed=false;this.expanded=true;if(a instanceof gara.widgets.Tree){this.tree=a;this.parentNode=this.tree.addItem(this,c)}else if(a instanceof gara.widgets.TreeItem){this.parentNode=a.addItem(this,c);this.tree=a.getParent();this.tree.addItem(this,c)}this.createWidget()},addItem:function(a,b){this.checkWidget();if(!(a instanceof gara.widgets.TreeItem)){throw new TypeError("item is not type of gara.widgets.TreeItem");}if(typeof(b)!=="undefined"){this.items.insertAt(b,a)}else{this.items.add(a)}if(this.items.length){this.childContainer.style.display=this.expanded?"block":"none";this.setClass("garaTreeItemExpanded",this.expanded);this.setClass("garaTreeItemCollapsed",!this.expanded)}return this.childContainer},bindListener:function(a,b){gara.addEventListener(this.img,a,b);gara.addEventListener(this.span,a,b)},createWidget:function(){var a,b,c,d,e,g=1,f=this;while(f.getParentItem()!==null){g++;f=f.getParentItem()}this.handle=document.createElement("li");this.handle.widget=this;this.handle.control=this.tree;this.handle.setAttribute("id",this.getId());this.handle.setAttribute("role","treeitem");this.handle.setAttribute("aria-selected",this.selected);this.handle.setAttribute("aria-expanded",this.expanded);this.handle.setAttribute("aria-level",g);this.handle.setAttribute("aria-labelledby",this.getId()+"-label");this.toggleNode=document.createElement("span");this.toggleNode.widget=this;this.toggleNode.control=this.tree;this.toggleNode.className="garaTreeItemToggler";this.toggleNode.setAttribute("role","presentation");this.handle.appendChild(this.toggleNode);if((this.tree.getStyle()&gara.CHECK)!==0){this.checkbox=document.createElement("span");this.checkbox.id=this.getId()+"-checkbox";this.checkbox.widget=this;this.checkbox.control=this.tree;this.checkbox.setAttribute("role","presentation");this.handle.appendChild(this.checkbox);this.handle.setAttribute("aria-checked",this.checked);this.setCheckboxClass()}this.img=document.createElement("img");this.img.id=this.getId()+"-image";this.img.widget=this;this.img.control=this.tree;this.img.className="garaItemImage garaTreeItemImage";this.img.setAttribute("role","presentation");this.handle.appendChild(this.img);if(this.image!==null){this.img.src=this.image.src}else{this.img.style.display="none"}this.spanText=document.createTextNode(this.getText());this.span=document.createElement("span");this.span.id=this.getId()+"-label";this.span.widget=this;this.span.control=this.tree;this.span.className="garaItemText garaTreeItemText";this.span.appendChild(this.spanText);this.span.setAttribute("role","presentation");this.handle.appendChild(this.span);this.childContainer=document.createElement('ul');this.childContainer.className="garaTreeItemChildContainer";this.childContainer.setAttribute("role","group");this.childContainer.style.display="none";this.handle.appendChild(this.childContainer);this.addClass("garaTreeItem");c=this.parent.getItems();d=c.indexOf(this);e=d===0?this.parentNode.firstChild:c[d-1].handle.nextSibling;if(!e){this.parentNode.appendChild(this.handle)}else{this.parentNode.insertBefore(this.handle,e)}a=this.parent.getItems();if(a.length>1){a[a.length-2].update()}if(a.indexOf(this)===a.length-1){this.addClass("garaLastTreeItem")}},deselectItems:function(){this.checkWidget();this.items.forEach(function(a,b,c){if(a.getItemCount()){a.deselectItems()}this.tree.deselect(a)},this)},destroyWidget:function(){this.tree.releaseItem(this);this.parent.releaseItem(this);this.items.forEach(function(a){a.release()},this);this.items=null;this.texts=null;this.images=null;this.tree=null;this.$super()},getChecked:function(){this.checkWidget();return this.checked},getExpanded:function(){this.checkWidget();return this.expanded},getGrayed:function(){this.checkWidget();return this.grayed},getImage:function(a){this.checkWidget();a=a||0;return this.images[a]},getItem:function(a){this.checkWidget();if(typeof(this.items.indexOf(a))=="undefined"){throw new RangeError("There is no item for the given index");}return this.items[a]},getItemCount:function(){return this.items.length},getItems:function(){return this.items},getParent:function(){return this.tree},getParentItem:function(){if(this.parent===this.tree){return null}else{return this.parent}},getText:function(a){this.checkWidget();a=a||0;return this.texts[a]},handleEvent:function(a){this.checkWidget();if((a.target===this.checkbox&&a.type==="mousedown")||(a.target===this.checkbox&&a.type==="mouseup")||(a.type==="keydown"&&a.keyCode===gara.SPACE)){a.info=gara.CHECK;if(a.type==="mouseup"){this.setChecked(!this.checked)}}switch(a.type){case"mousedown":if(a.target===this.toggleNode){this.setExpanded(!this.expanded)}break;case"contextmenu":a.preventDefault();break}},indexOf:function(a){this.checkWidget();if(!(a instanceof gara.widgets.TreeItem)){throw new TypeError("item not instance of gara.widgets.TreeItem");}return this.items.indexOf(a)},releaseItem:function(a){if(this.items.contains(a)){this.childContainer.removeChild(a.handle);this.items.remove(a);if(this.items.length===0){this.childContainer.style.display="none";this.removeClass("garaTreeItemExpanded");this.removeClass("garaTreeItemCollapsed")}}},remove:function(a){var b;this.checkWidget();b=this.items.removeAt(a)[0];this.tree.removeItem(b);if(!b.isDisposed()){b.dispose()}delete b;if(!this.items.length&&this.childContainer.style.display==="block"){this.childContainer.style.display="none";this.toggleNode.className="garaTreeItemToggler"}},removeAll:function(){this.checkWidget();while(this.items.length){this.remove(this.indexOf(this.items.pop()))}},removeArray:function(b){this.checkWidget();b.forEach(function(a){this.remove(a)},this)},removeRange:function(a,b){var c;this.checkWidget();for(c=a;c<=b;++c){this.remove(c)}},setCheckboxClass:function(){this.checkbox.className="garaCheckbox";if(this.checked&&this.grayed){this.checkbox.className+=" garaCheckboxGrayedChecked"}else if(this.grayed){this.checkbox.className+=" garaCheckboxGrayed"}else if(this.checked){this.checkbox.className+=" garaCheckboxChecked"}},setChecked:function(a){if(!this.grayed){this.checked=a;this.handle.setAttribute("aria-checked",this.checked);if((this.tree.getStyle()&gara.CHECK)!==0){this.setCheckboxClass()}}return this},setExpanded:function(a){this.checkWidget();if(this.tree.notifyTreeListener(a?"treeExpanded":"treeCollapsed",this)){this.expanded=a;this.handle.setAttribute("aria-expanded",this.expanded);if(!a){this.deselectItems()}if(this.items.length){this.setClass("garaTreeItemExpanded",this.expanded);this.setClass("garaTreeItemCollapsed",!this.expanded)}else{this.removeClass("garaTreeItemExpanded");this.removeClass("garaTreeItemCollapsed")}this.childContainer.style.display=this.expanded?"block":"none"}return this},setGrayed:function(a){this.grayed=a;this.checkbox.setAttribute("aria-disabled",this.grayed);this.setCheckboxClass();return this},setImage:function(a,b){if(typeof(b)==="undefined"){b=a;a=0}if(b!==null){this.img.src=b.src;this.img.style.display=""}else{this.img.src="";this.img.style.display="none"}this.images[a]=b;return this},setSelected:function(a){this.checkWidget();this.selected=a;this.handle.setAttribute("aria-selected",this.selected)},setText:function(a,b){if(typeof(a)==="string"){b=a;a=0}this.texts[a]=b;this.spanText.nodeValue=b;return this},unindListener:function(a,b){gara.removeEventListener(this.img,a,b);gara.removeEventListener(this.span,a,b)},update:function(){var a,b,c,d;this.checkWidget();a=0;b=this.items.length;while(a<b){var e=this.items[a];if(e.isDisposed()){this.remove(a);b--}else{e.update();a++}}c=this.parent.getItems();d=c.indexOf(this)===c.length-1;this.setClass("garaLastTreeItem",d)}}});