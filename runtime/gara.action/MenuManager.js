gara.provide("gara.action.MenuManager");gara.use("gara.widgets.Control");gara.use("gara.widgets.Menu");gara.use("gara.widgets.MenuItem");gara.Class("gara.action.MenuManager",{actions:[],menus:[],enabled:true,id:null,text:"",image:null,actionListener:null,$constructor:function(b,g,d){var c=this;this.actions=[];this.menus=[];this.enabled=true;this.text=b;this.image=g||null;this.id=d||g||null;this.actionListener={actionChanged:function(a){c.updateAction(a)}}},add:function(a){if(a instanceof gara.action.MenuManager){this.addMenuManager(a)}else{this.addAction(a)}},addAction:function(a){if(a.addActionChangedListener&&!this.actions.contains(a)){a.addActionChangedListener(this.actionListener);this.actions.push(a)}},addMenuManager:function(a){if(!(a instanceof gara.action.MenuManager)){throw new TypeError("manager not instance of gara.action.MenuManager");}if(!this.actions.contains(a)){this.actions.push(a)}},createContextMenu:function(a){if(!(a instanceof gara.widgets.Control)){throw new TypeError("control ist not instance of gara.widgets.Control");}var b=new gara.widgets.Menu(a);this.menus.push(b);this.updateMenu(b);a.setMenu(b);return b},createMenuBar:function(a){var b=new gara.widgets.Menu(a,gara.BAR);this.menus.push(b);this.updateMenu(b);return b},createToolBar:function(a){var b=new gara.widgets.Menu(a,gara.TOOLBAR);this.menus.push(b);this.updateMenu(b);return b},createMenuItem:function(g,d){var c=new gara.widgets.MenuItem(g,gara.CASCADE);if(d.getText){c.setText(d.getText())}if(d.getImage){c.setImage(d.getImage())}if(d.getEnabled){c.setEnabled(d.getEnabled())}c.setData(d);c.addSelectionListener({widgetSelected:function(a){var b;if(a.item instanceof gara.widgets.MenuItem){b=a.item.getData();if(b.run){b.run()}}}});if(d instanceof gara.action.MenuManager&&d.getSize()){this.createSubmenu(c,d)}},createSubmenu:function(a,b){b.submenu=new gara.widgets.Menu(a);a.setMenu(b.submenu);b.fillMenu(b.submenu)},dispose:function(){this.menus.forEach(function(a){a.dispose()},this);this.menus=null;this.actions.forEach(function(a){a.dispose()},this)},fillMenu:function(a){var b;if(!(a instanceof gara.widgets.Menu)){throw new TypeError("menu ist not instance of gara.widgets.Menu");}if(!this.menus.contains(a)){this.menus.push(a);for(b=0;b<this.actions.length;b++){this.createMenuItem(a,this.actions[b])}}},getEnabled:function(){return this.enabled},getId:function(){return this.id},getImage:function(){return this.image},getSize:function(){return this.actions.length},getText:function(){return this.text},remove:function(a){if(a instanceof gara.action.MenuManager){this.removeMenuManager(a)}else{this.removeAction(a)}},removeAction:function(a){if(a.removeActionChangedListener){a.removeActionChangedListener(this.actionListener);this.actions.remove(a)}},removeMenuManager:function(a){if(!(a instanceof gara.action.MenuManager)){throw new TypeError("manager not instance of gara.action.MenuManager");}this.actions.remove(a)},setEnabled:function(a){this.enabled=a},setId:function(a){this.id=a},setImage:function(a){this.image=a},setText:function(a){this.text=a},update:function(b){if(b instanceof gara.widgets.Menu){this.updateMenu(b)}else if(b&&b.addActionChangedListener){this.updateAction(b)}else{this.menus.forEach(function(a){this.updateMenu(a)},this)}},updateAction:function(g){this.menus.forEach(function(b){b.getItems().forEach(function(a){if(a.getData()===g){a.setText(g.getText());a.setImage(g.getImage());a.setEnabled(g.getEnabled());b.update()}},this)},this)},updateMenu:function(a){var b=a.getItems(),g=b.length,d=Math.min(g,this.actions.length),c,e,f;for(f=0;f<d;f++){e=this.actions[f];c=b[f];if(e.getText){c.setText(e.getText())}if(e.getImage){c.setImage(e.getImage())}if(e.getEnabled){c.setEnabled(e.getEnabled())}c.setData(e);if(e instanceof gara.action.MenuManager){if(e.submenu){e.update(e.submenu)}else{this.createSubmenu(c,e)}}}for(f=d;f<g;f++){c=b[f];c.setData(null);c.removeSelectionListener(this);c.dispose()}for(f=d;f<this.actions.length;f++){this.createMenuItem(a,this.actions[f])}a.update()}});